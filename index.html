<!DOCTYPE html>
<html>
  <head>
    <title>Decentralized Identifier Resolution (DID Resolution) v0.2</title>
    <meta http-equiv='Content-Type' content='text/html;charset=utf-8'/>
    <!--
      === NOTA BENE ===
      For the three scripts below, if your spec resides on dev.w3 you can check them
      out in the same tree and use relative links so that they'll work offline.
     -->
    <script src='https://www.w3.org/Tools/respec/respec-w3c-common' class='remove'></script>
    <!--script src='./respec-w3c-common.js' class='remove'></script-->
    <script src="./common.js"></script>
    <script type="text/javascript" class="remove">
      var respecConfig = {
        // specification status (e.g. WD, LCWD, NOTE, etc.). If in doubt use ED.
        specStatus: "CG-DRAFT",

        // the specification's short name, as in http://www.w3.org/TR/short-name/
        shortName: "did-resolution",

        // subtitle
        subtitle: "Resolution of Decentralized Identifiers (DIDs)",

        // if you wish the publication date to be other than today, set this
        // publishDate:  "2009-08-06",

        // if there is a previously published draft, uncomment this and set its YYYY-MM-DD date
        // and its maturity status
        // previousPublishDate:  "1977-03-15",
        // previousMaturity:  "WD",

        // extend the bibliography entries
        localBiblio: ccg.localBiblio,

        github: "https://github.com/w3c-ccg/did-resolution",
        includePermalinks: false,

        // if there a publicly available Editor's Draft, this is the link
        edDraftURI: "https://w3c-ccg.github.io/did-resolution/",

        // if this is a LCWD, uncomment and set the end of its review period
        // lcEnd: "2009-08-05",

        // editors, add as many as you like
        // only "name" is required
        editors: [
          { name: "Markus Sabadello", url: "https://www.linkedin.com/in/markus-sabadello-353a0821",
            company: "Danube Tech", companyURL: "https://danubetech.com/" },
          { name: "Dmitri Zagidulin", url: "https://www.linkedin.com/in/dzagidulin",
            company: "MIT CSAIL", companyURL: "http://computingjoy.com/" }
        ],

        // authors, add as many as you like.
        // This is optional, uncomment if you have authors as well as editors.
        // only "name" is required. Same format as editors.
        authors:
        [
          { name: "Markus Sabadello", url: "https://www.linkedin.com/in/markus-sabadello-353a0821",
            company: "Danube Tech", companyURL: "https://danubetech.com/" },
          { name: "Dmitri Zagidulin", url: "https://www.linkedin.com/in/dzagidulin",
            company: "MIT CSAIL", companyURL: "http://computingjoy.com/" }
        ],

        // name of the WG
        wg:           "Credentials Community Group",

        // URI of the public WG page
        wgURI:        "https://www.w3.org/community/credentials/",

        // name (with the @w3c.org) of the public mailing to which comments are due
        wgPublicList: "public-credentials",

        // URI of the patent status for this WG, for Rec-track documents
        // !!!! IMPORTANT !!!!
        // This is important for Rec-track documents, do not copy a patent URI from a random
        // document unless you know what you're doing. If in doubt ask your friendly neighbourhood
        // Team Contact.
        wgPatentURI:  "https://www.w3.org/community/about/agreements/cla/",
        maxTocLevel: 4,
        inlineCSS: true
      };
    </script>
    <style type="text/css">
      ol.algorithm {
        counter-reset: numsection;
        list-style-type: none;
      }
      ol.algorithm li {
        margin: 0.5em 0;
      }
      ol.algorithm li:before {
        font-weight: bold;
        counter-increment: numsection;
        content: counters(numsection, ".") ") ";
      }
    </style>
  </head>
  <body>
    <section id='abstract'>
      <p>
Decentralized Identifiers (DIDs) are a new type of identifier for
verifiable, "self-sovereign" digital identity. DIDs are fully under the
control of the DID subject, independent from any centralized registry,
identity provider, or certificate authority. DIDs resolve to DID
Documents â€” simple documents that describe how to use that specific DID.
      </p>

      <p>
This document specifies the algorithms and guidelines for resolving DIDs
and dereferencing DID URLs.
      </p>
    </section>

    <section id='sotd'>
    <p>
      Comments regarding this document are welcome. Please file issues
      directly on <a href="https://github.com/w3c-ccg/did-resolution/issues/">GitHub</a>,
      or send them to
      <a href="mailto:public-credentials@w3.org">public-credentials@w3.org</a>
      (<a href="mailto:public-credentials-request@w3.org?subject=subscribe">subscribe</a>,
      <a href="https://lists.w3.org/Archives/Public/public-credentials/">archives</a>).
      </p>

      <p>
      Portions of the work on this specification have been funded by the
      United States Department of Homeland Security's Science and Technology
      Directorate under contracts HSHQDC-17-C-00019. The content of this
      specification does not necessarily reflect the position or the policy of
      the U.S. Government and no official endorsement should be inferred.
      </p>

      <p>
      Work on this specification has also been supported by the Rebooting the
      Web of Trust community facilitated by Christopher Allen, Shannon
      Appelcline, Kiara Robles, Brian Weller, Betty Dhamers, Kaliya Young, Kim
      Hamilton Duffy, Manu Sporny, Drummond Reed, Joe Andrieu, and Heather
      Vescent.
      </p>
    </section>

<section id="introduction">
<h1>Introduction</h1>

	<p><a>DID resolution</a> is the process of obtaining a <a>DID document</a> for a given <a>DID</a>. This is one
	of four required operations that can be performed on any DID ("Read"; the other ones being "Create", "Update",
	and "Deactivate"). The details of these operations differ depending on the <a>DID method</a>.
	Building on top of <a>DID resolution</a>, <a>DID URL dereferencing</a> is the process of obtaining a resource
	for a given <a>DID URL</a>. Software and/or hardware that is able to execute these processes is called
	a <a>DID resolver</a>.
	
	<p>This
	specification defines common
	requirements, algorithms including their inputs and results, architectural options, and various considerations for the
	<a>DID resolution</a> and <a>DID URL dereferencing</a> processes.</p>

	<p>Note that while this specification defines some base-level functionality for DID resolution, the actual steps
	required to communicate with a DID's <a>Decentralized Identifier Registry</a> are defined by the applicable
	<a>DID method</a> specification.</p>

	<p class="note">The difference between "resolving" a <a>DID</a> and "dereferencing" a <a>DID URL</a>
	is being thoroughly discussed by the community. E.g. see
	<a href="https://github.com/w3c-ccg/did-spec/issues/166#issuecomment-464502719">this comment</a>.</p>

	<section id="conformance">

	</section>

</section>

<section id="terminology">
	<h1>Terminology</h1>

    <dl>
      <dt><dfn data-lt="DID|DIDs|decentralized identifiers">Decentralized Identifier</dfn> (DID)</dt>
      <dd>As defined in [[DECENTRALIZED-IDENTIFIERS]].</dd>
    </dl>
    <dl>
      <dt><dfn data-lt="DIR|decentralized identifier registry|decentralized identifier registries">Decentralized Identifier Registry</dfn> (DIR)</dt>
      <dd>As defined in [[DECENTRALIZED-IDENTIFIERS]].</dd>
    </dl>
    <dl>
      <dt><dfn data-lt="">DID document</dfn></dt>
      <dd>As defined in [[DECENTRALIZED-IDENTIFIERS]].</dd>
    </dl>
    <dl>
      <dt><dfn data-lt="">DID fragment</dfn></dt>
      <dd>As defined in [[DECENTRALIZED-IDENTIFIERS]].</dd>
    </dl>
    <dl>
      <dt><dfn data-lt="method|DID method's">DID method</dfn></dt>
      <dd>As defined in [[DECENTRALIZED-IDENTIFIERS]].</dd>
    </dl>
    <dl>
      <dt><dfn data-lt="">DID path</dfn></dt>
      <dd>As defined in [[DECENTRALIZED-IDENTIFIERS]].</dd>
    </dl>
    <dl>
      <dt><dfn data-lt="">DID query</dfn></dt>
      <dd>As defined in [[DECENTRALIZED-IDENTIFIERS]].</dd>
    </dl>
    <dl>
      <dt><dfn data-lt="">DID resolution</dt>
      <dd>An algorithm that takes a <a>DID</a> plus additional options as input and returns a <a>DID document</a>
      or a <a>DID resolution result</a> as output. This algorithm relies on the "Read" operation of the applicable
      <a>DID method</a>. See Section <a href="#resolving"></a>.</dd>
    </dl>
    <dl>
      <dt><dfn data-lt="DID resolver's">DID resolver</dt>
      <dd>Software and/or hardware that is capable of <a>DID resolution</a> and optionally
      <a>DID URL dereferencing</a> for at least one <a>DID method</a>.</dd>
    </dl>
    <dl>
      <dt><dfn data-lt="">DID resolution result</dt>
      <dd>A data structure that represents the result of the <a>DID resolution</a> or <a>DID URL dereferencing</a> algorithm.
      May contain a <a>DID document</a>. See Section <a href="#did-resolution-result"></a>.</dd>
    </dl>
    <dl>
      <dt><dfn data-lt="">DID URL</dfn></dt>
      <dd>As defined in [[DECENTRALIZED-IDENTIFIERS]].</dd>
    </dl>
    <dl>
      <dt><dfn data-lt="">DID URL dereferencing</dfn></dt>
      <dd>An algorithm that takes a <a>DID URL</a> plus additional options as input and returns a <a>DID document</a>,
      a <a>DID resolution result</a>, or various other types of resources as output. This algorithm relies
      on <a>DID resolution</a>. See Section <a href="#dereferencing"></a>.</dd>
    </dl>
    <dl>
      <dt><dfn data-lt="">Service Endpoint</dfn></dt>
      <dd>As defined in [[DECENTRALIZED-IDENTIFIERS]].</dd>
    </dl>

</section>

<section id="architectures">
	<h1>DID Resolver Architectures</h1>
	<p class="issue">TODO: Describe how <a>DID resolvers</a> are implemented and used, describe the relevance
	of <a>DID methods</a>.
	Explain the difference between "method architectures" and "binding architectures".</p>

	<section id="method-architectures">
		<h2>Method Architectures</h2>
		<p>The <a>DID resolution</a> algorithm involves executing the <a href="https://w3c-ccg.github.io/did-spec/#read-verify">Read</a>
		operation on a <a>DID</a> according to the DID's <a>method</a> (see <a href="#resolving"></a>).</p>

		<div class="note">
		<p>The mechanics of the "Read" operation can vary considerably between
		<a>DID methods</a>.</p>
		<p>No assumption should be made that:</p>
		<ul>
		<li>... an immutable blockchain is used as (part of) the <a>Decentralized Identifier Registry</a>.</li>
		<li>... interaction with a remote network is required during execution of the "Read" operation.</li>
		<li>... an actual <a>DID document</a> is stored in plain-text on a <a>Decentralized Identifier Registry</a>,
		or that the <a>DID document</a> can simply be retrieved via a standard protocol such as HTTP(S).
		While some <a>DID methods</a> may define their "Read" operation this way, others may
		define more complex multi-step processes that involve on-the-fly construction of a "virtual" <a>DID document</a>.</li>
		</ul>
		</div>

		<p>Depending on the exact nature of the <a>DID method's</a> "Read" operation, the interaction between a
		<a>DID resolver</a> and the <a>Decentralized Identifier Registry</a> may be described as "local" or "remote":</p>

		<figure id="figure-method-local">
			<img style="margin: auto; display: block; width: 100%;" src="diagrams/method-local.png"
			alt="Diagram showing a DID method that is 'local'.">
			<figcaption style="text-align: center;">
				A "local" <a>DID method</a> implementation.
			</figcaption>
		</figure>
		<figure id="figure-method-remote">
			<img style="margin: auto; display: block; width: 100%;" src="diagrams/method-remote.png"
			alt="Diagram showing a DID method that is 'remote'.">
			<figcaption style="text-align: center;">
				A "remote" <a>DID method</a> implementation.
			</figcaption>
		</figure>

		<p class="note">The terms "local" and "remote" are not absolute categories when describing DID methods
		and their implementations, but only an approximation with many possible variations.</p>
		<p class="issue">TODO: Describe full nodes vs. light clients, blockchain explorer APIs, state proofs, etc.</p>
		<p class="issue">TODO: Explain that even within a single <a>DID method</a>, different method architectures may be
		possible. For example, the "btcr" DID method could be implemented with "local" access to a full node, or with
		calls to a "remote" blockchain explorer API.</p>

		<p class="issue">As an example, mention what it means to "resolve" peer/off-ledger/microledger/edgechain DIDs (e.g. see
		<a href="https://lists.hyperledger.org/g/indy/topic/28597813">here</a> and 
		<a href="https://docs.google.com/presentation/d/1UnC_nfOUK40WS5TD_EhyDuFe5cStX-u0Z7wjoae_PqQ/">here</a>).</p>

		<p class="issue">As an example, mention what it means to "resolve" DIDs that are simply wrapped public keys (e.g. see
		<a href="https://github.com/uport-project/secp256k1-did-resolver">here</a> and
		<a href="https://github.com/w3c-ccg/did-spec/pull/55">here</a>).</p>

		<p>A <a>DID resolver</a> MUST support the <a>DID resolution</a> algorithm for at least one <a>DID method</a> and
		MAY support it for multiple <a>DID methods</a>:</p>
		<figure id="figure-method-multiple">
			<img style="margin: auto; display: block; width: 100%;" src="diagrams/method-multiple.png"
			alt="Diagram showing a DID resolver that supports multiple DID methods.">
			<figcaption style="text-align: center;">
				A <a>DID resolver</a> that supports multiple <a>DID methods</a>.
			</figcaption>
		</figure>

		<p>In this case, the above considerations about "local" and "remote" <a>DID method</a> implementations apply
		to each supported <a>DID method</a> individually.</p>

	</section>

	<section id="binding-architectures">
		<h2>Binding Architectures</h1>
		<p>The algorithms for <a>DID resolution</a> and <a>DID URL dereferencing</a> are defined as abstract functions
		(see <a href="#resolving"></a> and <a href="#dereferencing"></a>).</p>
		Those algorithms are implemented by <a>DID resolvers</a>. A <a>DID resolver</a> is used by an application or
		service via a <a>Binding</a>. Bindings define how the abstract functions are realized using concrete
		programming or communication interfaces. For example, Bindings could include SDK calls, APIs, command line
		tools, or the <a href="#bindings-https">HTTP(S) Binding</a>.</p>

		<figure id="figure-binding-local">
			<img style="margin: auto; display: block; width: 100%;" src="diagrams/binding-local.png"
			alt="Diagram showing a DID resolver with a binding that is 'local'.">
			<figcaption style="text-align: center;">
				A "local" binding for a <a>DID resolver</a>.
			</figcaption>
		</figure>
		<figure id="figure-binding-remote">
			<img style="margin: auto; display: block; width: 100%;" src="diagrams/binding-remote.png"
			alt="Diagram showing a DID resolver with a binding that is 'remote'.">
			<figcaption style="text-align: center;">
				A "remote" binding for a <a>DID resolver</a>.
			</figcaption>
		</figure>

		<div class="issue" data-number="28">
			<p>TODO: Describe "local" bindings vs. "remote" bindings, and implications for privacy, security and trust.</p>
			<p>Also describe mitigations against potential downsides of "remote" bindings, e.g.:</p>
			<ul>
				<li>A <a>DID resolver's</a> "remote" binding can use a trusted channel such as VPN or TLS with mutual authentication.</li>
				<li>A <a>DID resolver</a> can add a <a href="https://w3c-ccg.github.io/did-spec/#proof-optional">proof</a>
				to a <a>DID document</a>. Discuss what this does and doesn't achieve. Also see
				<a href="https://w3c-ccg.github.io/did-spec/#binding-of-identity">Binding of Identity</a>.</li>
				<li>A client could query multiple "remote" <a>DID resolvers</a> and compare results.</li>
			</ul>
		</div>
		<p class="issue">TODO: Discuss DID resolution in constrained user agents such as mobile apps and browsers.</p>

		<p>A <a>DID resolver</a> MAY invoke another <a>DID resolver</a> in order to delegate (part of)
		the <a>DID resolution</a> and <a>DID URL dereferencing</a> algorithms. For example, a <a>DID resolver</a> may be
		invoked via a "local" binding (such as a command line tool), which in turn invokes another DID resolver
		via a "remote" binding (such as the <a href="#bindings-https">HTTP(S) Binding</a>).</p>
		<figure id="figure-binding-chained">
			<img style="margin: auto; display: block; width: 100%;" src="diagrams/binding-chained.png"
			alt="Diagram showing a "local" DID resolver that invokes a "remote" DID resolver.">
			<figcaption style="text-align: center;">
				A "local" <a>DID resolver</a> that invokes a "remote" <a>DID resolver</a>, which in turn supports
				multiple <a>DID methods</a>.
			</figcaption>
		</figure>
		<p class="issue">TODO: Explain that different parts of the <a href="#dereferencing">DID URL dereferencing</a>
		function can be performed by different components of an architecture. E.g. if a <a>DID URL</a> contains a fragment
		such as <code>did:example:1234#keys-1</code>, then a "remote" <a>DID resolver</a> could be
		used to resolve a <a>DID</a> to its <a>DID document</a>, but the remaining steps of DID URL dereferencing (in this case,
		processing of the fragment) would be done by a "local" <a>DID resolver</a> or a client.</p>

	</section>

</section>

<section id="resolving">
	<h1>Resolving a DID</h1>

	<p>This section defines the inputs and the algorithm of <a>DID resolution</a>, which returns
	a <a>DID document</a> or a <a>DID resolution result</a> as output.
	This algorithm relies on the "Read" operation of the applicable <a>DID method</a>.</p>

	<p>The abstract interface to this algorithm is:</p>

	<code>resolve ( did, input-options )</code>

	<section id="resolving-input">
		<h2>Input</h2>
		<p>The inputs of the <a>DID resolution</a> algorithm are an <var>input <a>DID</a></var> and
		additional <var>input options</var>.</p>

		<section id="resolving-input-did">
			<h3>DID</h3>
			<p>The <var>input <a>DID</a></var> is REQUIRED for the <a>DID resolution</a> algorithm.</p>
			<p>The `method-name` component of the <var>input <a>DID</a></var> is called the <var>input <a>DID method</a></var>.</p>

		</section>

		<section id="resolving-input-result-type">
			<h3><code>result-type</code></h3>
			<p>The <code>result-type</code> <var>input option</var> can be used to request a certain
			type of result.</p>
			<p>This <var>input option</var> is OPTIONAL.</p>
			<p>Possible values of this option are:</p>
			<ul>
			<li>`"did-document"` (default value): Request a <a>DID document</a> as output.</li>
			<li>`"resolution-result"`: Request a <a>DID resolution result</a> as output (see <a href="#did-resolution-result"></a>).</li>
			</ul>
			<p class="issue">Discuss what this means for certain bindings (such as <a href="#bindings-https"></a>).</p>

		</section>

		<section id="resolving-input-version-id">
			<h3><code>version-id</code></h3>
			<p>The <code>version-id</code> input option can be used to request a specific
			version of a <a>DID document</a>.</p>
			<p>This <var>input option</var> is OPTIONAL. It is mutually exclusive with <a href="#resolving-input-version-time"></a>.</p>
			<p>See Section <a href="#versioning"></a> for additional considerations.</p>
			<p>The possible values of this option are specific to the <var>input <a>DID method</a></var>.</p>
			<p class="note">
			Possible values may include sequential numbers, random UUIDs, content hashes, etc.
			</p>

		</section>

		<section id="resolving-input-version-time">
			<h3><code>version-time</code></h3>
			<p>The <code>version-time</code> input option can used to request a specific
			version of a <a>DID document</a>.</p>
			<p>This <var>input option</var> is OPTIONAL. It is mutually exclusive with <a href="#resolving-input-version-id"></a>.</p>
			<p>See Section <a href="#versioning"></a> for additional considerations.</p>
			<p>The value of this option MUST be a string value of an [[!RFC3339]] combined date and time string representing
			the date and time the <a>DID document</a> was current for the <var>input <a>DID</a></var>.</p>

			<p class="issue">
			Help, what's the difference in ReSpec between a `[[RFC3339]]` and `[[!RFC3339]]` reference ?
			</p>

		</section>

		<section id="resolving-input-no-cache">
			<h3><code>no-cache</code></h3>
			<p>The <code>no-cache</code> input option can be used to 
			request a certain kind of caching behavior.</p>
			<p>This <var>input option</var> is OPTIONAL.</p>
			<p>Possible values of this option are:</p>
			<ul>
			<li>`"false"` (default value): Caching of <a>DID documents</a> is allowed.</li>
			<li>`"true"`: Request that caching is disabled and a fresh <a>DID document</a> is retrieved from
			the <a>Decentralized Identifier Registry</a>.</li>
			</ul>
			<p>See Section <a href="#caching"></a> for additional considerations.</p>

		</section>

	</section>

	<section id="resolving-algorithm">
		<h2>Algorithm</h2>
		<p>The following <a>DID resolution</a> algorithm MUST be implemented by a conformant <a>DID resolver</a>.</p>
		<ol class="algorithm">
			<li>Validate that the <var>input <a>DID</a></var> conforms to the `did` rule of the
			<a href="https://w3c-ccg.github.io/did-spec/#generic-did-syntax">Generic DID Syntax</a>.
			If not, the <a>DID resolver</a> MUST raise an error.</li>
			<li>Determine if the <var>input <a>DID method</a></var> is supported by the <a>DID resolver</a>
			that implements this algorithm. If not, the <a>DID resolver</a> MUST raise an error.</li>
			<li>Obtain the <a>DID document</a> for the <var>input <a>DID</a></var> by executing the
			<a href="https://w3c-ccg.github.io/did-spec/#read-verify">Read</a> operation against the
			<var>input <a>DID</a>'s</var> <a>Decentralized Identifier Registry</a>, as defined by the <var>input <a>DID method</a></var>:
			<ol class="algorithm">
				<li>Besides the <var>input <a>DID</a></var>, all additional <var>input options</var> of
				this algorithm MUST be passed to the
				<a href="https://w3c-ccg.github.io/did-spec/#read-verify">Read</a> operation of the
				<var>input <a>DID method</a></var>.</li>
				<li>If the <var>input <a>DID</a></var> does not exist, return a null result.</li>
				<li>The result of the <a href="https://w3c-ccg.github.io/did-spec/#read-verify">Read</a> operation
				is called the <var>output <a>DID document</a></var>.</li>
			</ol>
			</li>
			<li>Validate that the <var>output <a>DID document</a></var> conforms to the 
			<a href="https://w3c-ccg.github.io/did-spec/#did-documents">serialization</a> of the <a>DID document</a>
			<a href="https://w3c-ccg.github.io/did-spec/#data-model">data model</a>. If not,
			the <a>DID resolver</a> MUST raise an error.</li>
			<li>If the value of <a href="#resolving-input-result-type"><code>result-type</code></a> <var>input
			option</var> is <code>null</code> or <code>"did-document"</code>:
			<ol class="algorithm">
				<li>Return the <var>output <a>DID document</a></var>.</li>
			</ol>
			</li>
			<li>If the value to of <a href="#resolving-input-result-type"><code>result-type</code></a> <var>input
			option</var> is <code>"resolution-result"</code>:
			<ol class="algorithm">
				<li>Construct a <a>DID resolution result</a> and populate it with the <var>output <a>DID document</a></var>
				as well as metadata about the processes that produced the result (see <a href="#did-resolution-result"></a>.
				This is called the <var>output <a>DID resolution result</a></var>.</li>
				<li>Return the <var>output <a>DID resolution result</a></var>.</li>
			</ol>
			</li>
		</ol>

		<p class="issue" data-number="5">There is discussion how a DID that has been
		<a href="https://w3c-ccg.github.io/did-spec/#deactivate">deactivated</a> should be treated during the <a>DID resolution</a>
		process.</p>

		<p class="issue" data-number="13">Specify how signatures/proofs on a DID document should be verified during the
		DID resolution process.</p>

		<p class="issue">Should we define functionality that enables discovery of the list of <a>DID methods</a> or other
		capabilities that are supported by a <a>DID resolver</a>? Or is this implementation-specific and out-of-scope
		for this spec? E.g. see <a href="https://github.com/w3c-ccg/did-resolution/issues/26">here</a> and
		<a href="https://github.com/w3c-ccg/did-resolution/issues/25">here</a>.</p>

	</section>

</section>

<section id="dereferencing">
	<h1>Dereferencing a DID URL</h1>

	<p>This section defines the inputs and the algorithm of <a>DID URL dereferencing</a>, which returns
	a <a>DID document</a>, a <a>DID resolution result</a>, or various other types of resources as output.
	This algorithm relies on <a>DID resolution</a>.</p>

	<p>The abstract interface to this algorithm is:</p>

	<code>dereference ( did-url, input-options )</code>

	<section id="dereferencing-input">
		<h2>Input</h2>
		<p>The inputs of the <a>DID URL dereferencing</a> algorithm are an <var>input <a>DID URL</a></var> and
		additional <var>input options</var>.</p>

		<section id="dereferencing-input-did-url">
			<h3>DID URL</h3>
			<p>The <var>input <a>DID URL</a></var> is REQUIRED for the <a>DID URL dereferencing</a> algorithm.</p>
			<p>The `didÌ€` component of the <var>input <a>DID URL</a> is called the <var>input <a>DID</a></var>.</p>

		</section>

		<section id="dereferencing-input-result-type">
			<h3><code>result-type</code></h3>
			<p>The <code>result-type</code> <var>input option</var> can be used to request a certain
			type of result.</p>
			<p>This <var>input option</var> is OPTIONAL.</p>
			<p>Possible values of this option are:</p>
			<ul>
			<li>`"did-document"` (default value): Request a <a>DID document</a> as output.</li>
			<li>`"resolution-result"`: Request a <a>DID resolution result</a> as output (see <a href="#did-resolution-result"></a>).</li>
			</ul>
			<p class="issue">Discuss what this means for certain bindings (such as <a href="#bindings-https"></a>).</p>
			<p class="issue">Discuss additional result types that may exist for <a>DID URL dereferencing</a> but
			do not exist for <a>DID resolution</a>.</p>

		</section>

		<section id="dereferencing-input-service-type">
			<h3><code>service-type</code></h3>
			<p>The <code>service-type</code> input option can be supplied by a client to select a specific
			service from the DID document.</p>
			<p>This <var>input option</var> is OPTIONAL.</p>
			<p class="issue">See <a href="https://lists.w3.org/Archives/Public/public-credentials/2019Jun/0028.html">
			comments by Dave Longley</a> about `service-type`.</p>

		</section>

		<section id="dereferencing-input-follow-redirect">
			<h3><code>follow-redirect</code></h3>
			<p>The <code>follow-redirect</code> input option can be supplied by a client as a hint to 
			instruct whether redirects should be followed.</p>
			<p>This <var>input option</var> is OPTIONAL.</p>
			<p>See Section <a href="#redirect"></a>.</p>

		</section>

	</section>

	<section id="dereferencing-algorithm">
		<h2>Algorithm</h2>
		<p>The following <a>DID URL dereferencing</a> algorithm MUST be implemented by a conformant <a>DID resolver</a>.
		In accordance with [[RFC3986]], it consists of the following steps: Resolving the DID, dereferencing the primary
		resource, and dereferencing the secondary resource (only if the <var>input <a>DID URL</a></var> contains a <a>DID fragment</a>:</p>

		<ol class="algorithm">
			<li>Obtain the <a>DID document</a> for the <var>input <a>DID</a></var> by executing the
			<a>DID resolution</a> algorithm as defined in <a href="#resolving"></a>. All
				<a href="https://w3c-ccg.github.io/did-spec/#generic-did-parameter-names"> generic
				matrix parameters</a> as well as
				<a href="https://w3c-ccg.github.io/did-spec/#method-specific-did-parameter-names"> method-specific
				matrix parameters</a> of the <var>input <a>DID URL</a></var> MUST be passed as <var>input options</var> to the <a>DID
				Resolution</a> algorithm. If the <var>input <a>DID</a></var> does not exist, return a null result.
				Otherwise, the result is called the <var>resolved <a>DID document</a></var>.</li>
			</li>
			<li>If present, separate the <a>DID fragment</a> from the <var>input <a>DID URL</a></var>. Execute the algorithm for
			<a href="#dereferencing-algorithm-primary"></a>, with the <var>input <a>DID URL</a></var> adjusted
			accordingly.</li>
			<li>If the original <var>input <a>DID URL</a></var> contained a <a>DID fragment</a>, execute the algorithm for
			<a href="#dereferencing-algorithm-secondary"></a>.</li>
		</ol>

	</section>

	<section id="dereferencing-algorithm-primary">
		<h2>Dereferencing the Primary Resource</h2>
		<ol class="algorithm">
			<li>If the <var>input <a>DID URL</a></var> contains the
			<a href="https://w3c-ccg.github.io/did-spec/#generic-did-parameter-names"> generic
			matrix parameter</a> <code>service</code> and optionally a <a>DID path</a> and/or <a>DID query</a>:
			<pre class="example nohighlight">did:example:1234;service=agent/profile?query</pre>
			<ol class="algorithm">
				<li>From the <var>resolved <a>DID document</a></var>, select the
				<a href="#service-endpoint-construction">service endpoint</a> whose <code>id</code>
				property contains a fragment which matches the value of the <code>service</code> matrix parameter of the
				<var>input <a>DID URL</a></var>. This is called the <var>input <a>service endpoint</a></var>.</li>
				<li>Execute the <a href="#service-endpoint-construction">Service Endpoint Construction</a> algorithm:
				<ol class="algorithm">
					<li>Read the value of the <code>serviceEndpoint</code> property of the
					<var>input <a>service endpoint</a></var>. This is called the <var>input <a>service endpoint</a> URL</var>.</li>
					<li>Pass the <var>input <a>DID URL </a></var> and <var>input <a>service endpoint</a> URL</var> to
					the <a href="#service-endpoint-construction">Service Endpoint Construction</a> algorithm.</li>
					<li>The result is called the <var>output <a>service endpoint</a> URL</var>.</li>
				</ol>
				</li>
				<li>Return the <var>output <a>service endpoint</a> URL</var>.</li>
			</ol>
			</li>
			<li>Otherwise, if the <var>input <a>DID URL</a></var> contains
			<a href="https://w3c-ccg.github.io/did-spec/#method-specific-did-parameter-names"> method-specific
			matrix parameters</a>:</a>
			<pre class="example nohighlight">did:example:1234;example:object=myprofile</pre>
			<ol class="algorithm">
				<li>Defer to the applicable <a>DID Method</a> specification to determine how to dereference the
				<var>input <a>DID URL</a></var>.</li>
			</ol>
			<li>Otherwise, if the <var>input <a>DID URL</a></var> contains no <a>DID path</a> and no <a>DID query</a>:
			<pre class="example nohighlight">did:example:1234</pre>
			<ol class="algorithm">
				<li>Return the <var>resolved <a>DID document</a></var>.</li>
			</ol>
			</li>
			<li>Otherwise, if the <var>input <a>DID URL</a></var> contains a <a>DID path</a> and/or <a>DID query</a>:
			<pre class="example nohighlight">did:example:1234/custom/path?customquery</pre>
			<ol class="algorithm">
				<li>The applicable <a>DID Method</a> MAY specify how to dereference
				the <var>input <a>DID URL</a></var>.</li>
				<li>The client MAY be able to dereference the <var>input <a>DID URL</a></var>
				in an application-specific way.</li>
			</ol>
			</li>
			<li>If neither this algorithm, nor the applicable <a>DID Method</a>, nor the client
			is able to dereference the <var>input <a>DID URL</a></var>:
			<ol class="algorithm">
				<li>Return a null result.</li>
			</ol>
			</li>
		</ol>

	</section>

	<section id="dereferencing-algorithm-secondary">
		<h2>Dereferencing the Secondary Resource</h2>
		<p>If the <var>input <a>DID URL</a></var> contains a <a>DID fragment</a>,
		then dereferencing of the secondary resource identified by the URL is dependent not on the URI scheme, but
		on the media type ([[RFC2046]]) of the primary resource, i.e. on the result of
		<a href="#dereferencing-algorithm-primary"></a>.</p> 
		<ol class="algorithm">
			<li>If the result of <a href="#dereferencing-algorithm-primary"></a> is a <var>resolved <a>DID document</a></var>
			with MIME type <code>application/did+ld+json</code>, and the <var>input <a>DID URL</a></var> contains a
			<a>DID fragment</a>:
			<pre class="example nohighlight">did:example:1234#keys-1</pre>
			<ol class="algorithm">
				<li>From the <var>resolved <a>DID document</a></var>, select the JSON-LD object whose <code>id</code>
				property matches the <var>input <a>DID URL</a></var>, e.g. a public key or service endpoint in the
				<a>DID document</a>. This is called the <var>output resource</var>.
				Selecting the JSON-LD object from the <a>DID document</a> MUST take into account relative IRIs and
				the base IRI of the <var>resolved <a>DID document</a></var>.</li>
				<li>Return the <var>output resource</var>.
				<div class="issue" data-number="9">
				<p>Mention relative IRIs and that the DID itself is considered the base IRI for
				the JSON-LD parser. Mention potential attack vector if <code>@base</code> is injected into the
				<a>DID document</a>.</p>
				<p>Also see <a href="https://github.com/w3c-ccg/did-spec/issues/97">this discussion</a>
				on fully qualified DID URLs as the value of the <code>id</code> field.</p>
				</div>
				<p class="note">
				This use of the <a>DID fragment</a> is consistent with the definition of the fragment identifier in
				[[RFC3986]]. It identifies a <em>secondary resource</em> which is a subset of the <em>primary resource</em>
				(the <a>DID document</a>).
				</p>
				<p class="note">
				This use of the <a>DID fragment</a> is furthermore consistent with the concept of Hash URIs
				for the Semantic Web [[COOL-URIS]].
				</p>
				<p class="issue">
				Perhaps we can find a good reference somewhere from RDF, JSON-LD or Solid specifications that defines
				clearly the ability to use the fragment for identifying a specific resource in an RDF document.
				</p>
				</li>
			</ol>
			</li>
			<li>Otherwise, if the result of <a href="#dereferencing-algorithm-primary"></a> is an <var>output <a>service endpoint</a> URL</var>,
			and the <var>input <a>DID URL</a></var> contains a <a>DID fragment</a>:
			<pre class="example nohighlight">did:example:1234;service=agent/profile?query#frag</pre>
			<ol class="algorithm">
				<li>Append the <a>DID fragment</a> to the <var>output <a>service endpoint</a> URL</var>. In other words,
				the <var>output <a>service endpoint</a> URL</var> "inherits" the <a>DID fragment</a> of the
				<var>input <a>DID URL</a></var>.</li>
				<li>Return the <var>output <a>service endpoint</a> URL</var>.</li>
				<p class="note">
				This behavior of the <a>DID fragment</a> is analogous to the handling of a fragment in an HTTP URL in the
				case when dereferencing it returns an HTTP <code>3xx</code> (Redirection) response with a
				<code>Location</code> header (see section 7.1.2 of [[RFC7231]].
				</p>
				</li>
			</ol>
			<li>Otherwise, dereference the secondary resource as defined by the media type ([[RFC2046]]) of the primary resource.
			</li>
			</li>
		</ol>

	</section>
	
	<section>
		<h2>Additional Features</h2>
		<p class="note">This section lists additional <a>DID URL dereferencing</a> features that are under discussion and
		have not yet been incorporated into the algorithm.</p>

		<section id="redirect">
			<h3>Redirect</h3>
			<p>A <a href="https://w3c-ccg.github.io/did-spec/#dfn-service-endpoints">service endpoint</a> may have
			a <code>serviceEndpoint</code> property with a value that is itself
			a DID. This is interpreted as a "DID redirect" from the input DID to another. In this case, a "child"
			DID resolution process can be launched to get to a "final" service endpoint.</p>

			<p class="issue" data-number="7">See corresponding open issue.
			</p>

			<p class="issue" data-number="36">DID redirects could not only apply to a single service endpoint, but
			to an entire DID document, therefore enabling portability use cases.
			</p>

			<pre class="example nohighlight">
{
   "id": "did:example:123456789abcdefghi#hub1",
   "type": "HubService",
   "serviceEndpoint": "did:example:xyz"
}
</pre>

		</section>

		<section id="proxy">
			<h3>Proxy</h3>
			<p>A DID document may contain a "proxy" service type which would provide a mapping that 
			needs to be followed in order to resolve to a final service URL.</p>

			<p class="issue" data-number="35"></p>
			</p>

			<pre class="example nohighlight">
{
   "id": "did:example:123456789abcdefghi",
   "type": "ProxyService",
   "serviceEndpoint": "https://mydomain.com/proxy"
}
</pre>

		</section>

		<section id="json-pointer">
			<h3>JSON Pointer</h3>
			<div class="issue">
			<p>Several ways of selecting parts of a DID document are being discussed, including the use
			of JSON pointer.</p>
			<p>See corresponding <a href="https://github.com/w3c-ccg/did-spec/pull/161">PR</a>.</p>
			</div>

		</section>

	</section>

	<section>
		<h2>Examples</h2>
		<p>Given the following <var>resolved <a>DID document</a></var>:<p>
		<pre class="example nohighlight">
{
  "@context": ["https://w3id.org/did/v1", "https://w3id.org/security/v1"],
  "id": "did:example:123456789abcdefghi",
  "publicKey": [{
    "id": "did:example:123456789abcdefghi#keys-1",
    "type": "RsaVerificationKey2018",
    "publicKeyPem": "-----BEGIN PUB...0101010..END PUB -----\r\n"
  }],
  "service": [{
    "id": "did:example:123456789abcdefghi#agent",
    "type": "AgentService",
    "serviceEndpoint": "https://agent.example.com/8377464"
  }, {
    "id": "did:example:123456789abcdefghi#hub",
    "type": "HubService",
    "serviceEndpoint": "https://hub.example.com/.identity/did:example:0123456789abcdef/"
  }, {
    "id": "did:example:123456789abcdefghi#messages",
    "type": "MessagingService",
    "serviceEndpoint": "https://example.com/messages/8377464"
  }]
}
</pre>
		<p>Given the following <var>input <a>DID URL</a></var> and the <var>resolved <a>DID document</a></var> above:</p>
		<pre class="example nohighlight">
did:example:123456789abcdefghi#keys-1
</pre>
		<p>Then the result of the <a href="#dereferencing"></a> algorithm is the following <var>output resource</var>:</p>
		<pre class="example nohighlight">
{
  "@context": ["https://w3id.org/did/v1", "https://w3id.org/security/v1"],
  "id": "did:example:123456789abcdefghi#keys-1",
  "type": "RsaVerificationKey2018",
  "publicKeyPem": "-----BEGIN PUB...0101010..END PUB -----\r\n"
}
</pre>
		<p>Given the following <var>input <a>DID URL</a></var> and the <var>resolved <a>DID document</a></var> above:</p>
		<pre class="example nohighlight">
did:example:123456789abcdefghi;service=messages/some/path?query#frag
</pre>
		<p>Then the result of the <a href="#dereferencing"></a> algorithm is the following <var>output <a>service endpoint</a> URL</var>:</p>
		<pre class="example nohighlight">
https://example.com/messages/8377464/some/path?query#frag
</pre>
		<figure id="figure-dereferencing">
			<img style="margin: auto; display: block; width: 100%;" src="diagrams/did-url-dereferencing.png"
			alt="Diagram showing how a DID URL can be dereferencing to a service endpoint URL">
			<figcaption style="text-align: center;">
				Dereferencing a DID URL to a service endpoint URL.
			</figcaption>
		</figure>
		<p class="issue">Change the diagram and/or examples to make them consistent.</p>

	</section>

</section>

<section id="did-resolution-result">
	<h1>DID Resolution Result</h1>
	<p>This section defines a data structure that in some cases represents the result of the algorithms described
	in <a href="#resolving"></a> and <a href="#dereferencing"></a>. A <a>DID resolution result</a> contains
	a <a>DID document</a> or other result as well as metadata about the processes that produced the result.</p>

	<p class="issue" data-number="23">See corresponding open issue.</p>
	<p class="issue">Need to define how this data structure works exactly, and whether it always contains
	a <a>DID document</a> or can also contain other results.</p>

	<section>
		<h2>Example</h2>

		<pre class="example nohighlight" title="Example DID resolution result">
{
	"didDocument": {
		"id": "did:sov:WRfXPg8dantKVubE3HX8pw",
		"service": {
			"type": "xdi",
			"serviceEndpoint": "http://127.0.0.1:8080/xdi"
		},
		"authentication": {
			"type": "Ed25519SignatureAuthentication2018",
			"publicKey": ["did:sov:WRfXPg8dantKVubE3HX8pw#key-1"]
		},
		"publicKey": [{
			"id": "did:sov:WRfXPg8dantKVubE3HX8pw#key-1",
			"type": "Ed25519VerificationKey2018",
			"publicKeyBase58": "H3C2AVvLMv6gmMNam3uVAjZpfkcJCwDwnZn6z3wXmqPV"
		}],
		"@context": "https://w3id.org/did/v1"
	},
	"resolverMetadata": {
		"driverId": "did:sov",
		"driver": "HttpDriver",
		"retrieved": "2019-06-01T19:73:24Z",
		"duration": 1015
	},
	"methodMetadata": {
		"nymResponse": {
			"result": {
				"data": "{\"dest\":\"WRfXPg8dantKVubE3HX8pw\",\"identifier\":\"V4SGRU86Z58d6TV7PBUe6f\",\"role\":\"0\",\"seqNo\":11,\"txnTime\":1524055264,\"verkey\":\"H3C2AVvLMv6gmMNam3uVAjZpfkcJCwDwnZn6z3wXmqPV\"}",
				"type": "105",
				"txnTime": 1.524055264E9,
				"seqNo": 11.0,
				"reqId": 1.52725687080231475E18,
				"identifier": "HixkhyA4dXGz9yxmLQC4PU",
				"dest": "WRfXPg8dantKVubE3HX8pw"
			},
			"op": "REPLY"
		},
		"attrResponse": {
			"result": {
				"identifier": "HixkhyA4dXGz9yxmLQC4PU",
				"seqNo": 12.0,
				"raw": "endpoint",
				"dest": "WRfXPg8dantKVubE3HX8pw",
				"data": "{\"endpoint\":{\"xdi\":\"http://127.0.0.1:8080/xdi\"}}",
				"txnTime": 1.524055265E9,
				"type": "104",
				"reqId": 1.52725687092557056E18
			},
			"op": "REPLY"
		}
	}
}
</pre>

	</section>

	<section id="output-diddocument">
		<h2>DID Document</h2>
		<p>A <a>DID document</a> associated with a <a>DID</a>. The result of <a href="#resolving"></a>.</p>

	</section>

	<section id="output-resolvermetadata">
		<h2>Resolver Metadata</h2>
		<div class="issue">
		<p>TODO: Describe DID resolution metadata that is not method-specific, e.g.:</p>
		<ul>
		<li>Duration of the DID resolution process.</li>
		<li>Versioning information about the DID document (see Section <a href="#versioning"></a>).</li>
		<li>Caching information about the DID document (see Section <a href="#caching"></a>).</li>
		</ul>
		</div>

	</section>

	<section id="output-methodmetadata">
		<h2>Method Metadata</h2>
		<div class="issue">
		<p>TODO: Describe DID resolution metadata that is method-specific, e.g.:</p>
		<ul>
		<li>State proofs from the <a>Decentralized Identifier Registry</a>.</li>
		<li>Block number, index, transaction hash, number of confirmations, etc. of a record in the blockchain or other <a>Decentralized Identifier Registry</a>.</li>
		<li>Various URLs, IP addresses or other network information that was used during the DID resolution process.</li>
		</ul>
		</div>

	</section>

	<p class="issue">For certain data, it may be debatable whether it should be part of the DID document
	(i.e. data that describes the DID Subject), or whether it is metadata (i.e. data about the DID document or about
	the DID resolution process). For example the URL of the "Continuation DID document" in the BTCR method.
	</p>

</section>

<section id="service-endpoint-construction">
	<h1>Service Endpoint Construction</h1>

	<p>This section defines the inputs and the algorithm of <a>Service Endpoint Construction</a>,
	which returns a <a>service endpoint</a> URL as output. This algorithm is used when service endpoints
	are selected during <a>DID URL dereferencing</a> (see <a href="#dereferencing"></a>).</p>

	<p>In this section, <code>path</code>, <code>query</code>, and <code>fragment</code> are understood as defined in [[RFC3986]].</p>

	<section>
		<h2>Input</h2>

		<p>The inputs of the <a>Service Endpoint Construction</a> algorithm are an <var>input <a>DID URL</a></var> and an
		<var>input <a>service endpoint</a> URL</var>.</p>

		<p>The requirements for the inputs of the <a>Service Endpoint Construction</a> algorithm are as follows:</p>
		<ul>
			<li>The <var>input <a>DID URL</a></var> and <var>input <a>service endpoint</a> URL</var> MAY both have a <code>path</code> component.</li>
			<li>The <var>input <a>DID URL</a></var> and <var>input <a>service endpoint</a> URL</var> MUST NOT both have a <code>query</code> component.</li>
			<li>The <var>input <a>DID URL</a></var> and <var>input <a>service endpoint</a> URL</var> MUST NOT both have a <code>fragment</code> component.</li>
			<li>The <var>input <a>service endpoint</a> URL</var> MUST be an HTTP(S) URL.</li>
		</ul>

	</section>

	<section>
		<h2>Algorithm</h2>
		<ol class="algorithm">
			<li>Initialize a string <var>output <a>service endpoint</a> URL</var> to the value of the <var>input <a>service endpoint</a> URL</var></li>
			<li>If the <var>output <a>service endpoint</a> URL</var> has a <code>query</code> component, remove it.</li>
			<li>If the <var>output <a>service endpoint</a> URL</var> has a <code>fragment</code> component, remove it.</li>
			<li>Append the <code>path</code> component of the <var>input <a>DID URL</a></var> to the <var>output <a>service endpoint</a> URL</var>.</li>
			<li>If the <var>input <a>service endpoint</a> URL</var> has a <code>query</code> component, append <code>?</code> plus the <code>query</code> to the <var>output <a>service endpoint</a> URL</var>.</li>
			<li>If the <var>input <a>DID URL</a></var> has a <code>query</code> component, append <code>?</code> plus the <code>query</code> to the <var>output <a>service endpoint</a> URL</var>.</li>
			<li>If the <var>input <a>service endpoint</a> URL</var> has a <code>fragment</code> component, append <code>#</code> plus the <code>fragment</code> to the <var>output <a>service endpoint</a> URL</var>.</li>
			<li>If the <var>input <a>DID URL</a></var> has a <code>fragment</code> component, append <code>#</code> plus the <code>fragment</code> to the <var>output <a>service endpoint</a> URL</var>.</li>
			<li>Return the <var>output <a>service endpoint</a> URL</var>.</li>
		</ol>

		<p class="issue">We could potentially allow a <code>query</code> components on both the
		<var>input <a>DID URL</a></var> and <var>input <a>service endpoint</a> URL</var>, if they both contain lists of
		key/value parameters that can be merged.</p>

		<p class="issue">Details of the Service Endpoint Construction algorithm have been discussed in April 2019
		on the CCG mailing list, e.g. <a href="https://lists.w3.org/Archives/Public/public-credentials/2019Apr/0021.html">here</a>
		or <a href="https://lists.w3.org/Archives/Public/public-credentials/2019Apr/0032.html">here</a>.</p>

		<p class="issue">Instead of defining our own algorithm, we could potentially re-use the "Relative Resolution"
		algorithm defined in [[RFC3986]].</p>

	</section>

	<section>
		<h2>Example</h2>
		<p>Given the following <var>input <a>service endpoint</a> URL</var>:<p>
		<p><code>
https://example.com/messages/8377464</code></p>
		<p>And given the following <var>input <a>DID URL</a></var>:</p>
		<p><code>
did:example:123456789abcdefghi;service=messages/some/path?query#frag
</code></p>
		<p>Then the <var>output <a>service endpoint</a> URL</var> is:</p>
		<p><code>
https://example.com/messages/8377464/some/path?query#frag
</code></p>

	</section>

</section>

<section id="bindings">
	<h1>Bindings</h1>
	<p>This section defines bindings for the abstract algorithms in sections <a href="#resolving"></a> and
	<a href="#dereferencing"></a>.</p>

	<section id="bindings-https">
		<h2>HTTP(S) Binding</h2>
		<p>This section defines a <a>DID resolver</a> <a>Binding</a> which exposes the
		<a>DID resolution</a> and/or <a>DID URL dereferencing</a> functions (including all
		input options and output data) via an HTTP(S) endpoint. See <a href="#binding-architectures"></a>.</p>
		<div class="issue">
			<p>TODO: Define HTTP(S) Binding for <a>DID resolution</a> and <a>DID URL dereferencing</a>,
			including the following topics:</p>
			<ul>
				<li>How are <var>input options</var> passed via HTTP(S)? Using the query string and/or HTTP headers?</li>
				<li>How is the output data (<a>DID document</a>, <a>DID resolution result</a>) returned via HTTP(S)</li>
				<li>What is the <a href="https://github.com/w3c-ccg/did-spec/issues/82">MIME type of a DID document</a>?
				How should <code>Accept</code> and <code>Content-Type</code> HTTP headers be used?</li>
				<li>Are two separate HTTP(S) endpoints required/allowed for the <code>resolve()</code> and
				<code>dereference()</code> functions, or can/must a single HTTP(S) endpoint be used?</li>
			</ul>
		</div>

		<p>The HTTP(S) Binding for <a>DID resolvers</a> requires a known HTTP(S) URL called the
		<var><a>DID resolver</a> HTTP(S) endpoint</var>.</p>
		<p>Using this binding, the <a>DID resolution</a> function (see
		<a href="#resolving"></a>) and/or <a>DID URL dereferencing</a> function (see <a href="#dereferencing"></a>)
		can be executed as follows:</p>
		<ol class="algorithm">
			<li>Construct a <var>request HTTP(S) URL</var> by appending the <var>input <a>DID</a></var> or
			<var>input <a>DID URL</a></var> to the <var><a>DID resolver</a> HTTP(S) endpoint</var>.</li>
			<li>Execute an HTTP <code>GET</code> request on the <var>request HTTP(S) URL</var>.</li>
			<li>If the <var>input <a>DID</a></var> does not exist (i.e. the <a>DID resolution</a> function
			returns a null result):
			<ol class="algorithm">
				<li>The HTTP response status code MUST be <code>404</code>.</li>
			</ol>
			</li>
			<li>If the <var>input <a>DID</a></var> exists and the result is (part of) a <a>DID document</a>:
			<ol class="algorithm">
				<li>The HTTP response status code MUST be <code>200</code>.</li>
				<li>The HTTP response MUST contain a <code>Content-Type</code> header. The
				value of this header MUST be <code>application/did+ld+json</code>.</li>
				<li>The HTTP response body MUST contain the <var>resolved <a>DID document</a></var> or other
				<var>output resources</var> that is the reult of the <a>DID resolution</a> or
				<a>DID URL dereferencing</a> function.</li>
			</ol>
			</li>
			<li>If the <var>input <a>DID</a></var> exists and the result is a <a>service endpoint</a> URL:
			<ol class="algorithm">
				<li>The HTTP response status code MUST be <code>303</code>.</li>
				<li>The HTTP response MUST contain an <code>Location</code> header. The value of this header
				MUST be the <var>output <a>service endpoint</a> URL</a>.</li>
			</ol>
			</li>
		</ol>

	</section>

	<section>
		<h2>Example</h2>
		<p>Given the following <var><a>DID resolver</a> HTTP(S) endpoint</var>:<p>
		<p><code>
https://uniresolver.io/1.0/identifiers/</code></p>
		<p>And given the following <var>input <a>DID</a></var>:</p>
		<p><code>
did:sov:WRfXPg8dantKVubE3HX8pw</code></p>
		<p>Then the <var>request HTTP(S) URL</var> is:</p>
		<p><code>
https://uniresolver.io/1.0/identifiers/did:sov:WRfXPg8dantKVubE3HX8pw</code></p>
		<p>The HTTP(S) Binding can be invoked as follows:</p>
		<pre class="example nohighlight" title="Example curl call to a DID resolver via HTTP(S) Binding">
curl -X GET https://uniresolver.io/1.0/identifiers/did:sov:WRfXPg8dantKVubE3HX8pw</pre>

	</section>

</section>

<section id="errors">
	<h1>Errors</h1>
	<p class="issue">Do we need to define a list of error conditions, codes, etc.</p>

</section>

<section id="security-privacy-considerations">
	<h1>Security and Privacy Considerations</h1>

	<section id="authentication">
		<h2>Authentication/Authorization</h2>
		<p><a>DID resolution</a> and <a>DID URL dereferencing</a> do not involve any authentication or authorization
		functionality. Similar to DNS resolution, anybody can perform the process, without requiring any credentials
		or non-public knowledge.</p>

		<p class="issue" data-number="38"></p>

		<div class="issue">
		<p>Explain that DIDs are not necessarily <em>globally</em> resolvable, such as pairwise or N-wise
		"peer" DIDs.</p>
		<p>See [[RFC3339]]:
		<em> URIs have a global scope and are interpreted consistently regardless of context, though the
		result of that interpretation may be in relation to the end-user's context.</em>
		</p>
		<p>An advanced idea is that the result of DID resolution could be contextual or depend on policies,
		see <a href="https://github.com/w3c-ccg/did-resolution/issues/28#issuecomment-510592199">this comment</a>.</p>
		</div>

		<p class="issue">A related topic is whether (parts of) DID document could be encrypted, e.g. see
		<a href="https://github.com/w3c-ccg/did-spec/issues/172">w3c-ccg/did-spec/issues/172</a>. Also see the use
		of the fragment in the <a href="https://did-ipid.github.io/ipid-did-method/">IPID</a> DID method.</p>

	</section>

	<section id="caching">
		<h2>Caching</h2>
		<p>A <a>DID resolver</a> may maintain a generic cache of <a>DID documents</a>. It may also maintain caches specific
		to certain <a>DID methods</a>.</p>
		<p>Caching behavior can be controlled by configuration of the <a>DID resolver</a>,
		by the <a href="#resolving-input-no-cache">`no-cache`</a> input option, or by contents of the DID document
		(e.g. a `time-to-live` field), or by a combination of these options.</p>
		<p class="issue" data-number="10">See corresponding open issue.</p>
		<p class="issue">Perhaps we can re-use caching mechanisms of other protocols such as HTTP.</p>
	
	</section>

	<section id="versioning">
		<h2>Versioning</h2>
		<p>If a <a href="#resolving-input-version-id">`version-id`</a> or
		<a href="#resolving-input-version-time">`version-time`</a> input option is provided, the <a>DID resolution</a>
		algorithm returns a certain version of the <a>DID document</a>.</p>
		<p>A DID document MAY contain a version identifier that changes with each 
		<a href="https://w3c-ccg.github.io/did-spec/#update">Update</a> operation that is performed
		on a DID.</p>
		<p class="issue" data-number="12">See corresponding open issue.</p>
		<p class="note">While all <a>DID methods</a> MUST support the <a href="https://w3c-ccg.github.io/did-spec/#update">Update</a>
		operation, there is no requirement for <a>DID methods</a> to keep all previous <a>DID document</a> versions, therefore
		not all <a>DID methods</a> support versioning.
		</p>
	
	</section>
	
	<section id="non-did-identifiers">
		<h2>Non-DID identifiers</h2>
		<p class="issue" data-number="8">There is discussion on the relationship between <a>DID resolution</a> and
		resolution of non-DID identifiers such as domain names, HTTP URIs, or e-mail addresses. This includes the
		questions how DIDs can be discovered from non-DID identifiers, and how links between identifiers can
		be verifiable.</p>
	
	</section>

	<section id="did-method-governance">
		<h2>DID method governance</h2>
		<p class="issue" data-number="6">Describe which methods a <a>DID resolver</a> should support, and potential implications.</p>

	</section>

</section>

<section class="appendix">
	<h1>DID Resolution Resources</h1>

	<ol>
	<li><a href="https://w3c-ccg.github.io/did-spec/#did-resolvers">DID resolvers in DID spec</a></li>
	<li><a href="https://github.com/decentralized-identity/universal-resolver/">Universal Resolver</a></li>
	<li><a href="https://github.com/digitalbazaar/did-client">did-client</a></li>
	<li><a href="https://github.com/uport-project/did-resolver">uPort DID resolver</a></li>
	</ol>

</section>

</body>
</html>
