<!DOCTYPE html>
<html>
  <head>
    <title>Decentralized Identifier Resolution (DID Resolution) v0.2</title>
    <meta http-equiv='Content-Type' content='text/html;charset=utf-8'/>
    <!--
      === NOTA BENE ===
      For the three scripts below, if your spec resides on dev.w3 you can check them
      out in the same tree and use relative links so that they'll work offline.
     -->
    <script src='https://www.w3.org/Tools/respec/respec-w3c-common' class='remove'></script>
    <!--script src='./respec-w3c-common.js' class='remove'></script-->
    <script src="./common.js"></script>
    <script type="text/javascript" class="remove">
      var respecConfig = {
        // specification status (e.g. WD, LCWD, NOTE, etc.). If in doubt use ED.
        specStatus: "CG-DRAFT",

        // the specification's short name, as in http://www.w3.org/TR/short-name/
        shortName: "did-resolution",

        // subtitle
        subtitle: "Resolution of Decentralized identifiers (DIDs)",

        // if you wish the publication date to be other than today, set this
        // publishDate:  "2009-08-06",

        // if there is a previously published draft, uncomment this and set its YYYY-MM-DD date
        // and its maturity status
        // previousPublishDate:  "1977-03-15",
        // previousMaturity:  "WD",

        // extend the bibliography entries
        localBiblio: ccg.localBiblio,

        github: "https://github.com/w3c-ccg/did-resolution",
        includePermalinks: false,

        // if there a publicly available Editor's Draft, this is the link
        edDraftURI: "https://w3c-ccg.github.io/did-resolution/",

        // if this is a LCWD, uncomment and set the end of its review period
        // lcEnd: "2009-08-05",

        // editors, add as many as you like
        // only "name" is required
        editors: [
          { name: "Markus Sabadello", url: "https://www.linkedin.com/in/markus-sabadello-353a0821",
            company: "Danube Tech", companyURL: "https://danubetech.com/" },
          { name: "Dmitri Zagidulin", url: "https://www.linkedin.com/in/dzagidulin",
            company: "MIT CSAIL", companyURL: "http://computingjoy.com/" }
        ],

        // authors, add as many as you like.
        // This is optional, uncomment if you have authors as well as editors.
        // only "name" is required. Same format as editors.
        authors:
        [
          { name: "Markus Sabadello", url: "https://www.linkedin.com/in/markus-sabadello-353a0821",
            company: "Danube Tech", companyURL: "https://danubetech.com/" },
          { name: "Dmitri Zagidulin", url: "https://www.linkedin.com/in/dzagidulin",
            company: "MIT CSAIL", companyURL: "http://computingjoy.com/" }
        ],

        // name of the WG
        wg:           "Credentials Community Group",

        // URI of the public WG page
        wgURI:        "https://www.w3.org/community/credentials/",

        // name (with the @w3c.org) of the public mailing to which comments are due
        wgPublicList: "public-credentials",

        // URI of the patent status for this WG, for Rec-track documents
        // !!!! IMPORTANT !!!!
        // This is important for Rec-track documents, do not copy a patent URI from a random
        // document unless you know what you're doing. If in doubt ask your friendly neighbourhood
        // Team Contact.
        wgPatentURI:  "https://www.w3.org/community/about/agreements/cla/",
        maxTocLevel: 4,
        inlineCSS: true
      };
    </script>
    <style type="text/css">
      ol.algorithm {
        counter-reset: numsection;
        list-style-type: none;
      }
      ol.algorithm li {
        margin: 0.5em 0;
      }
      ol.algorithm li:before {
        font-weight: bold;
        counter-increment: numsection;
        content: counters(numsection, ".") ") ";
      }
    </style>
  </head>
  <body>
    <section id='abstract'>
      <p>
Decentralized identifiers (DIDs) are a new type of identifier for
verifiable, "self-sovereign" digital identity. DIDs are fully under the
control of the DID subject, independent from any centralized registry,
identity provider, or certificate authority. DIDs resolve to DID
Documents — simple documents that describe how to use that specific DID.
      </p>

      <p>
This document specifies the algorithms and guidelines for resolving DIDs
and dereferencing DID URLs.
      </p>
    </section>

    <section id='sotd'>
    <p>
      Comments regarding this document are welcome. Please file issues
      directly on <a href="https://github.com/w3c-ccg/did-resolution/issues/">GitHub</a>,
      or send them to
      <a href="mailto:public-credentials@w3.org">public-credentials@w3.org</a>
      (<a href="mailto:public-credentials-request@w3.org?subject=subscribe">subscribe</a>,
      <a href="https://lists.w3.org/Archives/Public/public-credentials/">archives</a>).
      </p>

      <p>
      Portions of the work on this specification have been funded by the
      United States Department of Homeland Security's Science and Technology
      Directorate under contracts HSHQDC-17-C-00019. The content of this
      specification does not necessarily reflect the position or the policy of
      the U.S. Government and no official endorsement should be inferred.
      </p>

      <p>
      Work on this specification has also been supported by the Rebooting the
      Web of Trust community facilitated by Christopher Allen, Shannon
      Appelcline, Kiara Robles, Brian Weller, Betty Dhamers, Kaliya Young, Kim
      Hamilton Duffy, Manu Sporny, Drummond Reed, Joe Andrieu, and Heather
      Vescent.
      </p>
    </section>

<section id="introduction">
<h1>Introduction</h1>

	<p><a>DID resolution</a> is the process of obtaining a <a>DID document</a> for a given <a>DID</a>. This is one
	of four required operations that can be performed on any DID ("Read"; the other ones being "Create", "Update",
	and "Deactivate"). The details of these operations differ depending on the <a>DID method</a>.
	Building on top of <a>DID resolution</a>, <a>DID URL dereferencing</a> is the process of retrieving a representation
	of a resource for a given <a>DID URL</a>. Software and/or hardware that is able to execute these processes is called
	a <a>DID resolver</a>.
	
	<p>This
	specification defines common
	requirements, algorithms including their inputs and results, architectural options, and various considerations for the
	<a>DID resolution</a> and <a>DID URL dereferencing</a> processes.</p>

	<p>Note that while this specification defines some base-level functionality for DID resolution, the actual steps
	required to communicate with a DID's <a>verifiable data registry</a> are defined by the applicable
	<a>DID method</a> specification.</p>

	<p class="note">The difference between "resolving" a <a>DID</a> and "dereferencing" a <a>DID URL</a>
	is being thoroughly discussed by the community. E.g. see
	<a href="https://github.com/w3c-ccg/did-spec/issues/166#issuecomment-464502719">this comment</a>.</p>

	<section id="conformance">

	</section>

</section>

<section id="terminology">
	<h1>Terminology</h1>

    <dl>
      <dt><dfn>binding</dfn></dt>
      <dd>A concrete mechanism through which a <a>client</a> invokes a <a>DID resolver</a>. This could be a <a>local binding</a> such as a local command line tool or library API, or a <a>remote binding</a> such as the <a href="#bindings-https">HTTP(S) binding</a>. See Section <a href="#resolver-architectures"></a>.</dd>
    </dl>
    <dl>
      <dt><dfn>client</dfn></dt>
      <dd>Software and/or hardware that invokes a <a>DID resolver</a> in order to execute the <a>DID resolution</a> and/or <a>DID URL dereferencing</a> algorithms. This invocation is done via a <a>binding</a>. The term <a>client</a> does not imply any specific network topology.</dd>
    </dl>
    <dl>
      <dt><dfn data-lt="DID|DIDs|decentralized identifiers">decentralized identifier</dfn> (DID)</dt>
      <dd>As defined in [[DID-CORE]].</dd>
    </dl>
    <dl>
      <dt><dfn data-lt="">DID document</dfn></dt>
      <dd>As defined in [[DID-CORE]].</dd>
    </dl>
    <dl>
      <dt><dfn data-lt="">DID fragment</dfn></dt>
      <dd>As defined in [[DID-CORE]].</dd>
    </dl>
    <dl>
      <dt><dfn data-lt="method|DID method's">DID method</dfn></dt>
      <dd>As defined in [[DID-CORE]].</dd>
    </dl>
    <dl>
      <dt><dfn data-lt="">DID path</dfn></dt>
      <dd>As defined in [[DID-CORE]].</dd>
    </dl>
    <dl>
      <dt><dfn data-lt="">DID query</dfn></dt>
      <dd>As defined in [[DID-CORE]].</dd>
    </dl>
    <dl>
      <dt><dfn data-lt="">DID resolution</dt>
      <dd>As defined in [[DID-CORE]]. See Section <a href="#resolving"></a>.</dd>
    </dl>
    <dl>
      <dt><dfn data-lt="DID resolver's">DID resolver</dt>
      <dd>As defined in [[DID-CORE]].</dd>
    </dl>
    <dl>
      <dt><dfn data-lt="">DID resolution result</dt>
      <dd>A data structure that represents the result of the <a>DID resolution</a> or <a>DID URL dereferencing</a> algorithm.
      May contain a <a>DID document</a> or other content. See Section <a href="#did-resolution-result"></a>.</dd>
    </dl>
    <dl>
      <dt><dfn data-lt="">DID URL</dfn></dt>
      <dd>As defined in [[DID-CORE]].</dd>
    </dl>
    <dl>
      <dt><dfn data-lt="">DID URL dereferencing</dfn></dt>
      <dd>As defined in [[DID-CORE]]. See Section <a href="#dereferencing"></a>.</dd>
	</dl>
	<dl>
		<dt><dfn data-lt="">local binding</dfn></dt>
		<dd>A <a>binding</a> where the <a>client</a> invokes a <a>DID resolver</a> that runs on the same network host, e.g. via a local command line tool or library API.
		In this case, the <a>DID resolver</a> is sometimes also called a "local <a>DID resolver</a>".
		See Section <a href="#resolver-architectures"></a>.</dd>
	</dl>
	<dl>
		<dt><dfn data-lt="">remote binding</dfn></dt>
		<dd>A <a>binding</a> where the <a>client</a> invokes a <a>DID resolver</a> that runs on a different network host, e.g. via the <a href="#bindings-https">HTTP(S) binding</a>.
		In this case, the <a>DID resolver</a> is sometimes also called a "remote <a>DID resolver</a>".
		See Section <a href="#resolver-architectures"></a>.</dd>
	</dl>
    <dl>
      <dt><dfn data-lt="">service endpoint</dfn></dt>
      <dd>As defined in [[DID-CORE]].</dd>
	</dl>
	<dl>
		<dt><dfn data-lt="">unverifiable read</dfn></dt>
		<dd> A low confidence implementation of a <a>DID method's</a> "Read" operation between the
		<a>DID resolver</a> and the <a>verifiable data registry</a>, to obtain the <a>DID document</a>.
		There is no guarantee about the integrity and correctness of the result. See Section <a href="#method-architectures"></a>.</dd>
	</dl>
    <dl>
      <dt><dfn data-lt="verifiable data registry|verifiable data registries">verifiable data registry</dfn></dt>
      <dd>As defined in [[DID-CORE]].</dd>
    </dl>
	<dl>
		<dt><dfn data-lt="">verifiable read</dfn></dt>
		<dd> A high confidence implementation of a <a>DID method's</a> "Read" operation between the
		<a>DID resolver</a> and the <a>verifiable data registry</a>, to obtain the <a>DID document</a>.
		There are guarantees about the integrity and correctness of the result to the extent possible under the applicable <a>DID method</a>.
		See Section <a href="#method-architectures"></a>.</dd>
	</dl>
	

</section>

<section id="resolving">
	<h1>Resolving a DID</h1>

	<p>This section defines the inputs and the algorithm of <a>DID resolution</a>, which returns
	a <a>DID document</a> or a <a>DID resolution result</a> as output.
	This algorithm relies on the "Read" operation of the applicable <a>DID method</a>.</p>

	<p>The abstract interface to this algorithm is:</p>

	<code>
resolve ( did, did-resolution-input-metadata ) <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt; ( did-resolution-metadata, did-document, did-document-metadata )
	</code>

	<section id="resolving-input">
		<h2>Input</h2>
		<p>The inputs of the <a>DID resolution</a> algorithm are an <var>input <a>DID</a></var> and
		additional <var>input metadata properties</var>.</p>

		<section id="resolving-input-did">
			<h3>DID</h3>
			<p>The <var>input <a>DID</a></var> is REQUIRED for the <a>DID resolution</a> algorithm.</p>
			<p>The `method-name` component of the <var>input <a>DID</a></var> is called the <var>input <a>DID method</a></var>.</p>

		</section>

		<section id="resolving-input-metadata-properties">
			<h3>Input Metadata Properties</h3>

			<section id="resolving-input-accept">
				<h4><code>accept</code></h4>
				<p>The <code>accept</code> <var>input metadata property</var> can be used to request a certain
				type of result.</p>
				<p>This <var>input metadata property</var> is OPTIONAL.</p>
				<p>Possible values of this property are:</p>
				<ul>
				<li>`application/did+ld+json` (or other MIME type of a conformant representation of a <a>DID document</a>): Request a <a>DID document</a> as output.</li>
				<li>`application/ld+json;profile="https://w3id.org/did-resolution"`: Request a <a>DID resolution result</a> as output (see <a href="#did-resolution-result"></a>).</li>
				</ul>
				<p class="issue">Discuss what this means for certain bindings (such as <a href="#bindings-https"></a>).</p>

			</section>

			<section id="resolving-input-version-id">
				<h4><code>version-id</code></h4>
				<p>The <code>version-id</code> input metadata property can be used to request a specific
				version of a <a>DID document</a>.</p>
				<p>This <var>input metadata property</var> is OPTIONAL. It is mutually exclusive with <a href="#resolving-input-version-time"></a>.</p>
				<p>See Section <a href="#versioning"></a> for additional considerations.</p>
				<p>The possible values of this property are specific to the <var>input <a>DID method</a></var>.</p>
				<p class="note">
				Possible values may include sequential numbers, random UUIDs, content hashes, etc.
				</p>

			</section>

			<section id="resolving-input-version-time">
				<h4><code>version-time</code></h4>
				<p>The <code>version-time</code> input metadata property can used to request a specific
				version of a <a>DID document</a>.</p>
				<p>This <var>input metadata property</var> is OPTIONAL. It is mutually exclusive with <a href="#resolving-input-version-id"></a>.</p>
				<p>See Section <a href="#versioning"></a> for additional considerations.</p>
				<p>The value of this property MUST be a string value of an [[!RFC3339]] combined date and time string representing
				the date and time the <a>DID document</a> was current for the <var>input <a>DID</a></var>.</p>

			</section>

			<section id="resolving-input-no-cache">
				<h4><code>no-cache</code></h4>
				<p>The <code>no-cache</code> input metadata property can be used to
				request a certain kind of caching behavior.</p>
				<p>This <var>input metadata property</var> is OPTIONAL.</p>
				<p>Possible values of this property are:</p>
				<ul>
				<li>`"false"` (default value): Caching of <a>DID documents</a> is allowed.</li>
				<li>`"true"`: Request that caching is disabled and a fresh <a>DID document</a> is retrieved from
				the <a>verifiable data registry</a>.</li>
				</ul>
				<p>See Section <a href="#caching"></a> for additional considerations.</p>

			</section>

		</section>

	</section>

	<section id="resolving-algorithm">
		<h2>Algorithm</h2>
		<p>The following <a>DID resolution</a> algorithm MUST be implemented by a conformant <a>DID resolver</a>.</p>
		<ol class="algorithm">
			<li>Validate that the <var>input <a>DID</a></var> conforms to the `did` rule of the
			<a href="https://w3c.github.io/did-core/#did-syntax">DID Syntax</a>.
			If not, the <a>DID resolver</a> MUST return the following result:
			<ol class="algorithm">
				<li><b>did-resolution-metadata</b>: <code>«[ "error" → "invalid-did" ]»</code></li>
				<li><b>did-document</b>: <code>null</code></li>
				<li><b>did-document-metadata</b>: <code>null</code></li>
			</ol>
			</li>
			<li>Determine if the <var>input <a>DID method</a></var> is supported by the <a>DID resolver</a>
			that implements this algorithm. If not, the <a>DID resolver</a> MUST return the following result:
			<ol class="algorithm">
				<li><b>did-resolution-metadata</b>: <code>«[ "error" → "not-supported" ]»</code></li>
				<li><b>did-document</b>: <code>null</code></li>
				<li><b>did-document-metadata</b>: <code>null</code></li>
			</ol>
			</li>
			<li>Obtain the <a>DID document</a> for the <var>input <a>DID</a></var> by executing the
			<a href="https://w3c.github.io/did-core/#read-verify">Read</a> operation against the
			<var>input <a>DID</a>'s</var> <a>verifiable data registry</a>, as defined by the <var>input <a>DID method</a></var>:
			<ol class="algorithm">
				<li>Besides the <var>input <a>DID</a></var>, all additional <var>input metadata properties</var> of
				this algorithm MUST be passed to the
				<a href="https://w3c.github.io/did-core/#read-verify">Read</a> operation of the
				<var>input <a>DID method</a></var>.</li>
				<li>If the <var>input <a>DID</a></var> does not exist, return the following result:
				<ol class="algorithm">
					<li><b>did-resolution-metadata</b>: <code>«[ "error" → "not-found" ]»</code></li>
					<li><b>did-document</b>: <code>null</code></li>
					<li><b>did-document-metadata</b>: <code>null</code></li>
				</ol>
				</li>
				<li>The result of the <a href="https://w3c.github.io/did-core/#read-verify">Read</a> operation
				is called the <var>output <a>DID document</a></var>.</li>
			</ol>
			</li>
			<li>Validate that the <var>output <a>DID document</a></var> conforms to a
			<a href="https://w3c.github.io/did-core/#core-representations">conformant serialization</a> of the <a>DID document</a>
			<a href="https://w3c.github.io/did-core/#data-model">data model</a>. If not,
			the <a>DID resolver</a> MUST raise an error.</li>
			<li>If the value of the <a href="#resolving-input-accept"><code>accept</code></a> <var>input
			metadata property</var> is <code>null</code> or `application/did+ld+json` (or other MIME type of a conformant representation of a <a>DID document</a>):
			<ol class="algorithm">
				<li>Return the <var>output <a>DID document</a></var>.</li>
			</ol>
			</li>
			<li>If the value of the <a href="#resolving-input-accept"><code>accept</code></a> <var>input
			metadata property</var> is `application/ld+json;profile="https://w3id.org/did-resolution"`:
			<ol class="algorithm">
				<li>Construct a <a>DID resolution result</a> and populate it with the <var>output <a>DID document</a></var>
				as well as 
				<a href="#output-resolutionmetadata">DID resolution metadata</a> and <a href="#output-documentmetadata">DID
				document metadata</a> (see <a href="#did-resolution-result"></a>.
				This is called the <var>output <a>DID resolution result</a></var>.</li>
				<li>Return the <var>output <a>DID resolution result</a></var>.</li>
			</ol>
			</li>
		</ol>

		<p class="issue" data-number="5">There is discussion how a DID that has been
		<a href="https://w3c.github.io/did-core/#deactivate">deactivated</a> should be treated during the <a>DID resolution</a>
		process.</p>

		<p class="issue" data-number="13">Specify how signatures/proofs on a DID document should be verified during the
		DID resolution process.</p>

		<p class="issue">Should we define functionality that enables discovery of the list of <a>DID methods</a> or other
		capabilities that are supported by a <a>DID resolver</a>? Or is this implementation-specific and out-of-scope
		for this spec? E.g. see <a href="https://github.com/w3c-ccg/did-resolution/issues/26">here</a> and
		<a href="https://github.com/w3c-ccg/did-resolution/issues/25">here</a>.</p>

	</section>

</section>

<section id="dereferencing">
	<h1>Dereferencing a DID URL</h1>

	<p>This section defines the inputs and the algorithm of <a>DID URL dereferencing</a>, which returns
	a <a>DID document</a>, a <a>DID resolution result</a>, or various other types of resources as output.
	This algorithm relies on <a>DID resolution</a>.</p>

	<p>The abstract interface to this algorithm is:</p>

	<code>
dereference ( did-url, did-url-dereferencing-input-metadata ) <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt; ( did-url-dereferencing-metadata, content, content-metadata )
	</code>

	<section id="dereferencing-input">
		<h2>Input</h2>
		<p>The inputs of the <a>DID URL dereferencing</a> algorithm are an <var>input <a>DID URL</a></var> and
		additional <var>input metadata properties</var>.</p>

		<section id="dereferencing-input-did-url">
			<h3>DID URL</h3>
			<p>The <var>input <a>DID URL</a></var> is REQUIRED for the <a>DID URL dereferencing</a> algorithm.</p>
			<p>The `did̀` component of the <var>input <a>DID URL</a> is called the <var>input <a>DID</a></var>.</p>

		</section>

		<section id="dereferencing-input-did-parameters">
			<h3>DID Parameters</h3>

			<section id="dereferencing-input-did-parameter-hl">
				<h4><code>hl</code></h4>
				<p>As defined in section <a href="https://w3c.github.io/did-core/#did-parameters">DID Parameters</a>
				in [[DID-CORE]].</p>

			</section>

			<section id="dereferencing-input-did-parameter-service">
				<h4><code>service</code></h4>
				<p>As defined in section <a href="https://w3c.github.io/did-core/#did-parameters">DID Parameters</a>
				in [[DID-CORE]].</p>

			</section>

			<section id="dereferencing-input-did-parameter-version-id">
				<h4><code>version-id</code></h4>
				<p>As defined in section <a href="https://w3c.github.io/did-core/#did-parameters">DID Parameters</a>
				in [[DID-CORE]].</p>

			</section>

			<section id="dereferencing-input-did-parameter-version-time">
				<h4><code>version-time</code></h4>
				<p>As defined in section <a href="https://w3c.github.io/did-core/#did-parameters">DID Parameters</a>
				in [[DID-CORE]].</p>

			</section>

			<section id="dereferencing-input-did-parameter-relative-ref">
				<h4><code>relative-ref</code></h4>
				<p>As defined in section <a href="https://w3c.github.io/did-core/#did-parameters">DID Parameters</a>
				in [[DID-CORE]].</p>

			</section>

			<section id="dereferencing-input-did-parameter-initial-state">
				<h4><code>initial-state</code></h4>
				<p>As defined in <a href="https://github.com/decentralized-identity/did-spec-extensions/blob/master/parameters/initial-state.md">Extension DID Parameter: initial-state</a>.</p>

			</section>

			<section id="dereferencing-input-did-parameter-transform-keys">
				<h4><code>transform-keys</code></h4>
				<p>As defined in <a href="https://github.com/decentralized-identity/did-spec-extensions/blob/master/parameters/transform-keys.md">Extension DID Parameter: transform-keys</a>.</p>

			</section>

		</section>

		<section id="dereferencing-input-metadata-properties">
			<h3>Input Metadata Properties</h3>

			<section id="dereferencing-input-accept">
				<h4><code>accept</code></h4>
				<p>The <code>accept</code> <var>input metadata property</var> can be used to request a certain
				type of result.</p>
				<p>This <var>input metadata property</var> is OPTIONAL.</p>
				<p>Possible values of this property are:</p>
				<ul>
				<li>`application/did+ld+json` (or other MIME type of a conformant representation of a <a>DID document</a>): Request a <a>DID document</a> as output.</li>
				<li>`application/ld+json;profile="https://w3id.org/did-resolution"`: Request a <a>DID resolution result</a> as output (see <a href="#did-resolution-result"></a>).</li>
				</ul>
				<p class="issue">Discuss what this means for certain bindings (such as <a href="#bindings-https"></a>).</p>
				<p class="issue">Discuss additional result types that may exist for <a>DID URL dereferencing</a> but
				do not exist for <a>DID resolution</a>.</p>

			</section>

			<section id="dereferencing-input-service-type">
				<h4><code>service-type</code></h4>
				<p>The <code>service-type</code> input metadata property can be supplied by a client to select a specific
				service from the DID document.</p>
				<p>This <var>input metadata property</var> is OPTIONAL.</p>
				<p class="issue">See <a href="https://lists.w3.org/Archives/Public/public-credentials/2019Jun/0028.html">
				comments by Dave Longley</a> about `service-type`.</p>

			</section>

			<section id="dereferencing-input-follow-redirect">
				<h4><code>follow-redirect</code></h4>
				<p>The <code>follow-redirect</code> input metadata property can be supplied by a client as a hint to
				instruct whether redirects should be followed.</p>
				<p>This <var>input metadata property</var> is OPTIONAL.</p>
				<p>See Section <a href="#redirect"></a>.</p>

			</section>

		</section>

	</section>

	<section id="dereferencing-algorithm">
		<h2>Algorithm</h2>
		<p>The following <a>DID URL dereferencing</a> algorithm MUST be implemented by a conformant <a>DID resolver</a>.
		In accordance with [[RFC3986]], it consists of the following steps: Resolving the DID, dereferencing the primary
		resource, and dereferencing the secondary resource (only if the <var>input <a>DID URL</a></var> contains a <a>DID fragment</a>:</p>

		<ol class="algorithm">
			<li>Obtain the <a>DID document</a> for the <var>input <a>DID</a></var> by executing the
			<a>DID resolution</a> algorithm as defined in <a href="#resolving"></a>. All
				<a href="https://w3c.github.io/did-core/#did-parameters">
				DID parameters</a> of the <var>input <a>DID URL</a></var> MUST be passed as <var>input metadata properties</var> to the <a>DID
				Resolution</a> algorithm. If the <var>input <a>DID</a></var> does not exist, return a null result.
				Otherwise, the result is called the <var>resolved <a>DID document</a></var>.</li>
			</li>
			<li>If present, separate the <a>DID fragment</a> from the <var>input <a>DID URL</a></var>. Execute the algorithm for
			<a href="#dereferencing-algorithm-primary"></a>, with the <var>input <a>DID URL</a></var> adjusted
			accordingly.</li>
			<li>If the original <var>input <a>DID URL</a></var> contained a <a>DID fragment</a>, execute the algorithm for
			<a href="#dereferencing-algorithm-secondary"></a>.</li>
		</ol>

	</section>

	<section id="dereferencing-algorithm-primary">
		<h2>Dereferencing the Primary Resource</h2>
		<ol class="algorithm">
			<li>If the <var>input <a>DID URL</a></var> contains the
			<a href="https://w3c.github.io/did-core/#generic-did-url-parameters">
			DID parameter</a> <code>service</code> and optionally the <code>relative-ref</code> DID parameter:
			<pre class="example nohighlight">did:example:1234?service=files&relative-ref=%2Fmyresume%2Fdoc%3Fversion%3Dlatest</pre>
			<ol class="algorithm">
				<li>From the <var>resolved <a>DID document</a></var>, select the
				<a href="#service-endpoint-construction">service endpoint</a> whose <code>id</code>
				property contains a fragment which matches the value of the <code>service</code> DID parameter of the
				<var>input <a>DID URL</a></var>. This is called the <var>input <a>service endpoint</a></var>.</li>
				<li>Execute the <a href="#service-endpoint-construction">Service Endpoint Construction</a> algorithm:
				<ol class="algorithm">
					<li>Read the value of the <code>serviceEndpoint</code> property of the
					<var>input <a>service endpoint</a></var>. This is called the <var>input <a>service endpoint</a> URL</var>.</li>
					<li>Pass the <var>input <a>DID URL </a></var> and <var>input <a>service endpoint</a> URL</var> to
					the <a href="#service-endpoint-construction">Service Endpoint Construction</a> algorithm.</li>
					<li>The result is called the <var>output <a>service endpoint</a> URL</var>.</li>
				</ol>
				</li>
				<li>Return the <var>output <a>service endpoint</a> URL</var>.</li>
			</ol>
			</li>
			<li>Otherwise, if the <var>input <a>DID URL</a></var> contains
			<a href="https://w3c.github.io/did-core/#method-specific-did-url-parameters"> method-specific
			DID parameters</a>:</a>
			<pre class="example nohighlight">did:example:1234?example:object=myprofile</pre>
			<ol class="algorithm">
				<li>Defer to the applicable <a>DID method</a> specification to determine how to dereference the
				<var>input <a>DID URL</a></var>.</li>
			</ol>
			<li>Otherwise, if the <var>input <a>DID URL</a></var> contains no <a>DID path</a> and no <a>DID query</a>:
			<pre class="example nohighlight">did:example:1234</pre>
			<ol class="algorithm">
				<li>Return the <var>resolved <a>DID document</a></var>.</li>
			</ol>
			</li>
			<li>Otherwise, if the <var>input <a>DID URL</a></var> contains a <a>DID path</a> and/or <a>DID query</a>:
			<pre class="example nohighlight">did:example:1234/custom/path?customquery</pre>
			<ol class="algorithm">
				<li>The applicable <a>DID method</a> MAY specify how to dereference
				the <var>input <a>DID URL</a></var>.</li>
				<li>The client MAY be able to dereference the <var>input <a>DID URL</a></var>
				in an application-specific way.</li>
			</ol>
			</li>
			<li>If neither this algorithm, nor the applicable <a>DID method</a>, nor the client
			is able to dereference the <var>input <a>DID URL</a></var>:
			<ol class="algorithm">
				<li>Return a null result.</li>
			</ol>
			</li>
		</ol>

	</section>

	<section id="dereferencing-algorithm-secondary">
		<h2>Dereferencing the Secondary Resource</h2>
		<p>If the <var>input <a>DID URL</a></var> contains a <a>DID fragment</a>,
		then dereferencing of the secondary resource identified by the URL is dependent not on the URI scheme, but
		on the media type ([[RFC2046]]) of the primary resource, i.e. on the result of
		<a href="#dereferencing-algorithm-primary"></a>.</p> 
		<ol class="algorithm">
			<li>If the result of <a href="#dereferencing-algorithm-primary"></a> is a <var>resolved <a>DID document</a></var>
			with MIME type <code>application/did+ld+json</code>, and the <var>input <a>DID URL</a></var> contains a
			<a>DID fragment</a>:
			<pre class="example nohighlight">did:example:1234#keys-1</pre>
			<ol class="algorithm">
				<li>From the <var>resolved <a>DID document</a></var>, select the JSON-LD object whose <code>id</code>
				property matches the <var>input <a>DID URL</a></var>, e.g., a public key or service endpoint in the
				<a>DID document</a>. This is called the <var>output resource</var>.
				When selecting the JSON-LD object from the <a>DID document</a>, the absolute
				<a>DID URL</a> used to identify a graph node MUST be unique and present only once in the
				<a>DID document</a>. If the identifier of the graph node is not unique,
				including if a relative or base IRI mapped to an absolute IRI collides with
				a different graph node's absolute IRI, then an error MUST be thrown.
				<li>Return the <var>output resource</var>.
				<div class="issue" data-number="9">
				<p>Mention relative IRIs and that the DID itself is considered the base IRI for
				the JSON-LD parser. Mention potential attack vector if <code>@base</code> is injected into the
				<a>DID document</a>.</p>
				<p>Also see <a href="https://github.com/w3c/did-core/issues/15">this discussion</a>
				on fully qualified DID URLs as the value of the <code>id</code> field.</p>
				</div>
				<p class="note">
				This use of the <a>DID fragment</a> is consistent with the definition of the fragment identifier in
				[[RFC3986]]. It identifies a <em>secondary resource</em> which is a subset of the <em>primary resource</em>
				(the <a>DID document</a>).
				</p>
				<p class="note">
				This use of the <a>DID fragment</a> is furthermore consistent with the concept of Hash URIs
				for the Semantic Web [[COOL-URIS]].
				</p>
				<p class="issue">
				Perhaps we can find a good reference somewhere from RDF, JSON-LD or Solid specifications that defines
				clearly the ability to use the fragment for identifying a specific resource in an RDF document.
				</p>
				</li>
			</ol>
			</li>
			<li>Otherwise, if the result of <a href="#dereferencing-algorithm-primary"></a> is an <var>output <a>service endpoint</a> URL</var>,
			and the <var>input <a>DID URL</a></var> contains a <a>DID fragment</a>:
			<pre class="example nohighlight">did:example:1234?service=files&relative-ref=%2Fmyresume%2Fdoc%3Fversion%3Dlatest#intro</pre>
			<ol class="algorithm">
				<li>Append the <a>DID fragment</a> to the <var>output <a>service endpoint</a> URL</var>. In other words,
				the <var>output <a>service endpoint</a> URL</var> "inherits" the <a>DID fragment</a> of the
				<var>input <a>DID URL</a></var>.</li>
				<li>Return the <var>output <a>service endpoint</a> URL</var>.</li>
				<p class="note">
				This behavior of the <a>DID fragment</a> is analogous to the handling of a fragment in an HTTP URL in the
				case when dereferencing it returns an HTTP <code>3xx</code> (Redirection) response with a
				<code>Location</code> header (see section 7.1.2 of [[RFC7231]].
				</p>
				</li>
			</ol>
			<li>Otherwise, dereference the secondary resource as defined by the media type ([[RFC2046]]) of the primary resource.
			</li>
			</li>
		</ol>

	</section>

	<section>
		<h2>Examples</h2>
		<p>Given the following <var>resolved <a>DID document</a></var>:<p>
		<pre class="example nohighlight">
{
  "@context": "https://www.w3.org/ns/did/v1",
  "id": "did:example:123456789abcdefghi",
  "publicKey": [{
    "id": "did:example:123456789abcdefghi#keys-1",
    "type": "RsaVerificationKey2018",
    "publicKeyPem": "-----BEGIN PUB...0101010..END PUB -----\r\n"
  }],
  "service": [{
    "id": "did:example:123456789abcdefghi#agent",
    "type": "AgentService",
    "serviceEndpoint": "https://agent.example.com/8377464"
  }, {
    "id": "did:example:123456789abcdefghi#hub",
    "type": "HubService",
    "serviceEndpoint": "https://hub.example.com/.identity/did:example:0123456789abcdef/"
  }, {
    "id": "did:example:123456789abcdefghi#messages",
    "type": "MessagingService",
    "serviceEndpoint": "https://example.com/messages/8377464"
  }]
}
</pre>
		<p>Given the following <var>input <a>DID URL</a></var> and the <var>resolved <a>DID document</a></var> above:</p>
		<pre class="example nohighlight">
did:example:123456789abcdefghi#keys-1
</pre>
		<p>Then the result of the <a href="#dereferencing"></a> algorithm is the following <var>output resource</var>:</p>
		<pre class="example nohighlight">
{
  "@context": "https://www.w3.org/ns/did/v1",
  "id": "did:example:123456789abcdefghi#keys-1",
  "type": "RsaVerificationKey2018",
  "publicKeyPem": "-----BEGIN PUB...0101010..END PUB -----\r\n"
}
</pre>
		<p>Given the following <var>input <a>DID URL</a></var> and the <var>resolved <a>DID document</a></var> above:</p>
		<pre class="example nohighlight">
did:example:123456789abcdefghi?service=messages&relative-ref=%2Fsome%2Fpath%3Fquery#frag
</pre>
		<p>Then the result of the <a href="#dereferencing"></a> algorithm is the following <var>output <a>service endpoint</a> URL</var>:</p>
		<pre class="example nohighlight">
https://example.com/messages/8377464/some/path?query#frag
</pre>
		<figure id="figure-dereferencing">
			<img style="margin: auto; display: block; width: 100%;" src="diagrams/did-url-dereferencing.png"
			alt="Diagram showing how a DID URL can be dereferencing to a service endpoint URL">
			<figcaption style="text-align: center;">
				Dereferencing a DID URL to a service endpoint URL.
			</figcaption>
		</figure>
		<p class="issue">Change the diagram and/or examples to make them consistent.</p>

	</section>

</section>

<section id="architectures">
	<h1>DID Resolution Architectures</h1>
	<p class="issue">TODO: Describe how <a>DID resolvers</a> are implemented and used, describe the relevance
	of <a>DID methods</a>.
	Explain the difference between "method architectures" and "resolver architectures".</p>

	<section id="method-architectures">
		<h2>Method Architectures</h2>
		<p>The <a>DID resolution</a> algorithm involves executing the <a href="https://w3c.github.io/did-core/#read-verify">Read</a>
		operation on a <a>DID</a> according to its <a>DID method</a> (see <a href="#resolving"></a>).</p>

		<div class="note">
		<p>The mechanics of the "Read" operation can vary considerably between
		<a>DID methods</a>. In particular, no assumption should be made that:</p>
		<ul>
		<li>... an immutable blockchain is used as (part of) the <a>verifiable data registry</a>.</li>
		<li>... interaction with a remote network is required during execution of the "Read" operation.</li>
		<li>... an actual <a>DID document</a> is stored in plain-text on a <a>verifiable data registry</a>,
		or that the <a>DID document</a> can simply be retrieved via a standard protocol such as HTTP(S).
		While some <a>DID methods</a> may define their "Read" operation this way, others may
		define more complex multi-step processes that involve on-the-fly construction of a "virtual" <a>DID document</a>.</li>
		</ul>
		</div>

		<p class="issue">As an example, mention what it means to "resolve" peer/off-ledger/microledger/edgechain DIDs (e.g. see
		[[DID-PEER]] and
		<a href="https://docs.google.com/presentation/d/1UnC_nfOUK40WS5TD_EhyDuFe5cStX-u0Z7wjoae_PqQ/">here</a>).</p>

		<p class="issue">As an example, mention what it means to "resolve" DIDs that are simply wrapped public keys (e.g. see
		[[DID-KEY]] and
		<a href="https://github.com/w3c-ccg/did-spec/pull/55">here</a>).</p>

		<p>Depending on the exact nature of the <a>DID method's</a> "Read" operation, the interaction between a
		<a>DID resolver</a> and the <a>verifiable data registry</a> may be implemented as a <a>verifiable read</a>
		or <a>unverifiable read</a>:</p>

		<figure id="figure-method-verifiable">
			<img style="margin: auto; display: block; width: 100%;" src="diagrams/method-verifiable.png"
			alt="Diagram showing a 'verifiable read' implementation of a DID method.">
			<figcaption style="text-align: center;">
				A <a>verifiable read</a> implementation of a <a>DID method</a>.
			</figcaption>
		</figure>
		<figure id="figure-method-unverifiable">
			<img style="margin: auto; display: block; width: 100%;" src="diagrams/method-unverifiable.png"
			alt="Diagram showing an 'unverifiable read' implementation of a DID method.">
			<figcaption style="text-align: center;">
				An <a>unverifiable read</a> implementation of a <a>DID method</a>.
			</figcaption>
		</figure>

		<p>
			A <a>verifiable read</a> maximizes confidence in the integrity and correctness of the result of the "Read" operation ‐ to the extent
			possible under the applicable <a>DID method</a>. It can be implemented in a variety of ways, for example:
		</p>

		<ul>
		<li>A "Read" operation may be considered "Verifiable" if access to the <a>verifiable data registry</a> is
			possible via a local, trusted network host. In the case of blockchain-based <a>DID methods</a>, a blockchain full node
			may be run on a local network host in order to implement a <a>verifiable read</a>.</li>
		<li>The <a>DID resolver</a> may be remotely connected to the <a>verifiable data registry</a> but have some method
			to verify the contents of the response of the "Read" operation. In the case of blockchain-based <a>DID methods</a>, even if
			direct access to a blockchain full node is not available, a <a>verifiable read</a> may still be possible by running a light client that
			processes metadata to verify that the result of the "Read" operation hasn't been tampered with.</li>
		<li>A <a>verifiable read</a> may be implemented if access to the <a>verifiable data registry</a> happens via a remote
			network host that is considered trusted because it is run on a personal device in the home and accessed via
			a secure channel.</li>
		</ul>

		<p>
			An <a>unverifiable read</a> does not have such guarantees and is therefore less desirable, for example:
		</p>

		<ul>
		<li>A "Read" operation may be considered "Unverifiable" if access to the <a>verifiable data registry</a> happens
			via a remote, untrusted intermediary. In the case of blockchain-based <a>DID methods</a>, a remote blockchain explorer API
			operated by an third party may be used to look up data from the blockchain.</li>
		</ul>

		<p>
			Whether or not a <a>verifiable read</a> is possible depends not only on a <a>DID method</a> itself, but also on the way how
			a <a>DID resolver</a> implements it. <a>DID methods</a> MAY define multiple different ways of implementing their "Read"
			operation(s) and SHOULD offer guidance on how to implement a <a>verifiable read</a> in at least one way.
		</p>

		<p class="note">
			The guarantees associated with a <a>verifiable read</a> are still always limited by the architectures, protocols, cryptography,
			and other aspects of the underlying <a>verifiable data registry</a>. The strongest forms of <a>verifiable read</a>
			implementations are considered those that do not require any interaction with a remote network at all (for example, see
			[[DID-KEY]]), or that minimize dependencies on specific network infrastructure and reduce the "root of trust"
			to proven entropy and cryptography alone (for example, see [[KERI]]).
		</p>

		<p class="issue">TODO: Describe how a client can potentially verify the result of a "Read" operation independently even if it does
		not trust the DID resolver (e.g. using state proofs).</p>

		<p>A <a>DID resolver</a> MUST support the <a>DID resolution</a> algorithm for at least one <a>DID method</a> and
		MAY support it for multiple <a>DID methods</a>:</p>
		<figure id="figure-method-multiple">
			<img style="margin: auto; display: block; width: 100%;" src="diagrams/method-multiple.png"
			alt="Diagram showing a DID resolver that supports multiple DID methods.">
			<figcaption style="text-align: center;">
				A <a>DID resolver</a> that supports multiple <a>DID methods</a>.
			</figcaption>
		</figure>

		<p>In this case, the above considerations about <a>verifiable read</a> and <a>unverifiable read</a>
		implementations apply to each supported <a>DID method</a> individually.</p>

	</section>

	<section id="resolver-architectures">
		<h2>Resolver Architectures</h2>
		<p>The algorithms for <a>DID resolution</a> and <a>DID URL dereferencing</a> are defined as abstract functions
		(see <a href="#resolving"></a> and <a href="#dereferencing"></a>).</p>
		Those algorithms are implemented by <a>DID resolvers</a>. A <a>DID resolver</a> is invoked by a <a>client</a>
		via a <a>binding</a>. bindings define how the abstract functions are realized using concrete
		programming or communication interfaces. It is possible to distinguish between <a>local bindings</a>
		(such as a local command line tool or library API) and <a>remote bindings</a> (such as the
		<a href="#bindings-https">HTTP(S) binding</a>).</p>

		<figure id="figure-binding-local">
			<img style="margin: auto; display: block; width: 100%;" src="diagrams/binding-local.png"
			alt="Diagram showing a DID resolver with a 'local binding'.">
			<figcaption style="text-align: center;">
				A <a>local binding</a> for a <a>DID resolver</a>.
			</figcaption>
		</figure>
		<figure id="figure-binding-remote">
			<img style="margin: auto; display: block; width: 100%;" src="diagrams/binding-remote.png"
			alt="Diagram showing a DID resolver with a 'remote binding'.">
			<figcaption style="text-align: center;">
				A <a>remote binding</a> for a <a>DID resolver</a>.
			</figcaption>
		</figure>

		<div class="issue" data-number="28">
			<p>TODO: Describe <a>local bindings</a> vs. <a>remote bindings</a>, and implications for privacy, security and trust.</p>
			<p>Also describe mitigations against potential downsides of <a>remote bindings</a>, e.g.:</p>
			<ul>
				<li>A <a>DID resolver's</a> <a>remote binding</a> can use a trusted channel such as VPN or TLS with mutual authentication.</li>
				<li>A <a>DID resolver</a> can add a <a href="https://w3c-ccg.github.io/ld-proofs/">proof</a>
				to a <a>DID document</a> and/or the <a>DID resolution result</a>. Discuss what this does and doesn't achieve. Also see
				<a href="https://w3c.github.io/did-core/#binding-of-identity">binding of Identity</a>.</li>
				<li>A client could query multiple <a>DID resolvers</a> over a <a>remote binding</a> and compare results.</li>
			</ul>
		</div>
		<p class="issue">TODO: Discuss DID resolution in constrained user agents such as mobile apps and browsers.</p>

	<section id="resolver-architectures-proxied">
		<h2>Proxied Resolution</h2>

		<p>A <a>DID resolver</a> MAY invoke another <a>DID resolver</a>, which serves as a proxy that executes
		the <a>DID resolution</a> algorithm as defined in <a href="#resolving"></a>.</p>

		<p>The first <a>DID resolver</a> then acts
		as a <a>client</a> and chooses a suitable <a>binding</a> for invoking the second <a>DID resolver</a>. For example, a <a>DID resolver</a> may be
		invoked via a <a>local binding</a> (such as a command line tool), which in turn invokes another <a>DID resolver</a>
		via a <a>remote binding</a> (such as the <a href="#bindings-https">HTTP(S) binding</a>).</p>

		<figure id="figure-proxied-dereferencing">
			<img style="margin: auto; display: block; width: 100%;" src="diagrams/proxied-dereferencing.png"
			alt="Diagram showing two DID resolvers, one invoked via 'local binding', the other invoked via 'remote binding'.">
			<figcaption style="text-align: center;">
				A client invokes a <a>DID resolver</a> via <a>local binding</a> which invokes another <a>DID resolver</a> via
				<a>remote binding</a>, which in turn supports resolving multiple <a>DID methods</a>.
			</figcaption>
		</figure>

		<p class="note">This is similar to a "stub resolver" invoking a "recursive resolver" in DNS architecture, although
		the concepts are not entirely comparable (DNS Resolution uses a single concrete protocol, whereas DID resolution
		is an abstract function realized by different <a>DID methods</a> and different <a>bindings</a>).</p>

	</section>

	<section id="resolver-architectures-client-side">
		<h2>Client-Side Dereferencing</h2>

		<p>Different parts of the <a href="#dereferencing">DID URL dereferencing</a>
		algorithm may be performed by different components of a <a href="#resolver-architectures">Resolver Architecture</a>.</p>

		<p>Specifically, when a <a>DID URL</a> with a <a>DID fragment</a> is dereferenced, then
		<a href="#dereferencing-algorithm-primary">Dereferencing the Primary Resource</a> is done by
		the <a>DID resolver</a>, and
		<a href="#dereferencing-algorithm-secondary">Dereferencing the Secondary Resource</a> is done by the <a>client</a>.</p>

		<p>Example: Given the <a>DID URL</a> <code>did:xyz:1234#keys-1</code>, a <a>DID resolver</a> could be invoked
		via <a>local binding</a>
		for <a href="#dereferencing-algorithm-primary">Dereferencing the Primary Resource</a> (i.e. the <a>DID document</a>),
		and the <a>client</a> could complete the <a>DID URL dereferencing</a> algorithm by
		<a href="#dereferencing-algorithm-secondary">Dereferencing the Secondary Resource</a> (i.e. a part of the <a>DID document</a>).</p>

		<figure id="figure-client-side-dereferencing-1">
			<img style="display: block; width: 100%;" src="diagrams/client-side-dereferencing-1.png"
			alt="Diagram showing client-side dereferencing of a DID URL by a DID resolver and a client">
			<figcaption style="text-align: center;">
				Client-side dereferencing of a <a>DID URL</a> by a <a>DID resolver</a> and a <a>client</a>.
			</figcaption>
		</figure>

		<p>Example: Given the <a>DID URL</a> <code>did:xyz:1234#keys-1</code>, a <a>DID resolver</a> could be invoked via
		<a>local binding</a> which invokes another <a>DID resolver</a> via <a>remote binding</a>
		for <a href="#dereferencing-algorithm-primary">Dereferencing the Primary Resource</a> (i.e. the <a>DID document</a>),
		and the <a>client</a> could complete the <a>DID URL dereferencing</a> algorithm by
		<a href="#dereferencing-algorithm-secondary">Dereferencing the Secondary Resource</a> (i.e. a part of the <a>DID document</a>).</p>

		<figure id="figure-client-side-dereferencing-3">
			<img style="margin: auto; display: block; width: 100%;" src="diagrams/client-side-dereferencing-2.png"
			alt="Diagram showing client-side dereferencing of a DID URL by two DID resolvers and a client">
			<figcaption style="text-align: center;">
				Client-side dereferencing (in combination with <a href="#resolver-architectures-proxied">Proxied Resolution</a>)
				of a <a>DID URL</a> by two <a>DID resolvers</a> and a <a>client</a>.
			</figcaption>
		</figure>

		<p>Example: Given the <a>DID URL</a> <code>did:xyz:1234?service=agent&relative-ref=%2Fsome%2Fpath%3Fquery#frag</code>, a <a>DID resolver</a> could be invoked
		for <a href="#dereferencing-algorithm-primary">Dereferencing the Primary Resource</a> (i.e. a <a>service endpoint</a> URL),
		and the <a>client</a> could complete the <a>DID URL dereferencing</a> algorithm by
		<a href="#dereferencing-algorithm-secondary">Dereferencing the Secondary Resource</a> (i.e. a <a>service endpoint</a> URL with a fragment).</p>

		<figure id="figure-client-side-dereferencing-2">
			<img style="margin: auto; display: block; width: 100%;" src="diagrams/client-side-dereferencing-3.png"
			alt="Diagram showing client-side dereferencing of a DID URL by a DID resolver and a client">
			<figcaption style="text-align: center;">
				Client-side dereferencing of a <a>DID URL</a> by a <a>DID resolver</a> and a <a>client</a>.
			</figcaption>
		</figure>

	</section>

	</section>

</section>

<section id="did-resolution-result">
	<h1>DID Resolution Result</h1>
	<p>This section defines a data structure that represents the result of the algorithms described
	in <a href="#resolving"></a> and <a href="#dereferencing"></a>. A <a>DID resolution result</a> contains
	a <a>DID document</a> as well as
	<a href="#output-resolutionmetadata">DID resolution metadata</a> and <a href="#output-documentmetadata">DID
	document metadata</a>.</p>

	<section>
		<h2>Example</h2>

		<pre class="example nohighlight" title="Example DID resolution result">
{
	"@context": "https://w3id.org/did-resolution/v1",
	"didDocument": {
		"@context": "https://www.w3.org/ns/did/v1",
		"id": "did:example:123456789abcdefghi",
		"authentication": [{
			"id": "did:example:123456789abcdefghi#keys-1",
			"type": "Ed25519VerificationKey2018",
			"controller": "did:example:123456789abcdefghi",
			"publicKeyBase58": "H3C2AVvLMv6gmMNam3uVAjZpfkcJCwDwnZn6z3wXmqPV"
		}],
		"service": [{
			"id":"did:example:123456789abcdefghi#vcs",
			"type": "VerifiableCredentialService",
			"serviceEndpoint": "https://example.com/vc/"
		}]
	},
	"didResolutionMetadata": {
		"content-type": "application/did+ld+json",
		"retrieved": "2024-06-01T19:73:24Z",
	},
	"didDocumentMetadata": {
		"created": "2019-03-23T06:35:22Z",
		"updated": "2023-08-10T13:40:06Z",
		"method": {
			"nymResponse": {
				"result": {
					"data": "{\"dest\":\"WRfXPg8dantKVubE3HX8pw\",\"identifier\":\"V4SGRU86Z58d6TV7PBUe6f\",\"role\":\"0\",\"seqNo\":11,\"txnTime\":1524055264,\"verkey\":\"H3C2AVvLMv6gmMNam3uVAjZpfkcJCwDwnZn6z3wXmqPV\"}",
					"type": "105",
					"txnTime": 1.524055264E9,
					"seqNo": 11.0,
					"reqId": 1.52725687080231475E18,
					"identifier": "HixkhyA4dXGz9yxmLQC4PU",
					"dest": "WRfXPg8dantKVubE3HX8pw"
				},
				"op": "REPLY"
			},
			"attrResponse": {
				"result": {
					"identifier": "HixkhyA4dXGz9yxmLQC4PU",
					"seqNo": 12.0,
					"raw": "endpoint",
					"dest": "WRfXPg8dantKVubE3HX8pw",
					"data": "{\"endpoint\":{\"xdi\":\"http://127.0.0.1:8080/xdi\"}}",
					"txnTime": 1.524055265E9,
					"type": "104",
					"reqId": 1.52725687092557056E18
				},
				"op": "REPLY"
			}
		}
	}
}
</pre>

	<p class="issue" data-number="23">See corresponding open issue.</p>
	<p class="issue">Need to define how this data structure works exactly, and whether it always contains
	a <a>DID document</a> or can also contain other results.</p>

	</section>

	<section id="output-diddocument">
		<h2>DID Document</h2>
		<p>A <a>DID document</a> associated with a <a>DID</a>. The result of <a href="#resolving"></a>.</p>

	</section>

	<section id="output-resolutionmetadata">
		<h2>DID Resolution Metadata</h2>
		<p>This is a metadata structure (see section <a href="https://w3c.github.io/did-core/#metadata-structure">Metadata Structure</a>
		in [[DID-CORE]]) that contains metadata about the <a>DID Resolution</a> process.</p>
		<p>This metadata typically changes between invocations of the <a>DID Resolution</a> functions as it represents data about the resolution process itself.</p>
		<p>The source of this metadata is the DID resolver.</p>
		<p>Examples of DID Resolution Metadata include:</p>
		<ul>
		<li>MIME type of the returned content (the <b>content-type</b> metadata property).</li>
		<li>Error code (the <b>error</b> metadata property).</li>
		<li>Duration of the DID resolution process.</li>
		<li>Versioning information about the DID document (see Section <a href="#versioning"></a>).</li>
		<li>Caching information about the DID document (see Section <a href="#caching"></a>).</li>
		<li>Various URLs, IP addresses or other network information that was used during the DID resolution process.</li>
		<li>Proofs added by a DID resolver (e.g. to establish trusted resolution).</li>
		</ul>
		<p>See also section <a href="https://w3c.github.io/did-core/#did-resolution-metadata-properties">DID Resolution Metadata Properties</a>
		in [[DID-CORE]].</p>

	</section>

	<section id="output-documentmetadata">
		<h2>DID Document Metadata</h2>
		<p>This is a metadata structure (see section <a href="https://w3c.github.io/did-core/#metadata-structure">Metadata Structure</a>
		in [[DID-CORE]]) that contains metadata about a <a>DID Document</a>.</p>
		<p>This metadata typically does not change between invocations of the <a>DID Resolution</a> function unless the <a>DID document</a> changes, as it represents data about the <a>DID document</a>.</p>
		<p>The sources of this metadata are the <a>DID controller</a> and/or the <a>DID registry</a>.</p>
		<p>Examples of DID Document Metadata include:</p>
		<ul>
		<li>Timestamps when the DID and its associated DID document were created or updated (the <b>created</b> and <b>updated</b> metadata properties).</li>
		<li>Metadata about controllers, capabilities, delegations, etc.</li>
		<li>Proofs added by a DID controller (e.g. to establish control authority).</li>
		</ul>
		<p>DID Document Metadata may also include method-specific metadata, e.g.:</p>
		<ul>
		<li>State proofs from the <a>verifiable data registry</a>.</li>
		<li>Block number, index, transaction hash, number of confirmations, etc. of a record in the blockchain or other <a>verifiable data registry</a>.</li>
		</ul>
		<p>See also section <a href="https://w3c.github.io/did-core/#did-document-metadata-properties">DID Document Metadata Properties</a>
		in [[DID-CORE]].</p>

	</section>

	<p class="issue">For certain data, it may be debatable whether it should be part of the DID document
	(i.e. data that describes the DID Subject), or whether it is metadata (i.e. data about the DID document or about
	the DID resolution process). For example the URL of the "Continuation DID document" in the BTCR method.
	</p>

</section>

<section id="bindings">
	<h1>Bindings</h1>
	<p>This section defines bindings for the abstract algorithms in sections <a href="#resolving"></a> and
	<a href="#dereferencing"></a>.</p>

	<section id="bindings-https">
		<h2>HTTP(S) Binding</h2>
		<p>This section defines a <a>DID resolver</a> <a>binding</a> which exposes the
		<a>DID resolution</a> and/or <a>DID URL dereferencing</a> functions (including all
		input metadata properties and output data) via an HTTP(S) endpoint. See <a href="#resolver-architectures"></a>.</p>

		<p>The HTTP(S) binding for <a>DID resolvers</a> requires a known HTTP(S) URL called the
		<var><a>DID resolver</a> HTTP(S) endpoint</var>.</p>
		<p>Using this binding, the <a>DID resolution</a> function (see
		<a href="#resolving"></a>) and/or <a>DID URL dereferencing</a> function (see <a href="#dereferencing"></a>)
		can be executed as follows:</p>
		<ol class="algorithm">
			<li>Initialize a <var>request HTTP(S) URL</var> with the <var><a>DID resolver</a> HTTP(S) endpoint</var>.</li>
			<ol class="algorithm">
				<li>Append the <var>input <a>DID</a></var> or
				<var>input <a>DID URL</a></var> to the <var>request HTTP(S) URL</var>. Certain characters
				MUST be percent-encoded (as specified in <a
data-cite="RFC3986#section-2.1">RFC3986 Section 2.1</a>).</li>
				<li>Encode the <a href="#dereferencing-input-metadata-properties">input metadata properties</a> as
				query parameters in the <var>request HTTP(S) URL</var>.</li>
			</ol>
			<li>Execute an HTTP <code>GET</code> request on the <var>request HTTP(S) URL</var>.</li>
			<li>If the <var>input <a>DID</a></var> does not exist (i.e. the <b>did-resolution-metadata</b> output of the
			<a>DID resolution</a> function contains a metadata property <b>error</b> with value <b>not-found</b>):
			<ol class="algorithm">
				<li>The HTTP response status code MUST be <code>404</code>.</li>
			</ol>
			</li>
			<li>If the <var>input <a>DID</a></var> exists and the result is (part of) a <a>DID document</a>:
			<ol class="algorithm">
				<li>The HTTP response status code MUST be <code>200</code>.</li>
				<li>The HTTP response MUST contain a <code>Content-Type</code> header. The
				value of this header MUST be `application/did+ld+json` (or other MIME type of a conformant representation of a <a>DID document</a>).</li>
				<li>The HTTP response body MUST contain the <var>resolved <a>DID document</a></var> or other
				<var>output resources</var> that is the result of the <a>DID resolution</a> or
				<a>DID URL dereferencing</a> function.</li>
			</ol>
			</li>
			<li>If the <var>input <a>DID</a></var> exists and the result is a <a>service endpoint</a> URL:
			<ol class="algorithm">
				<li>The HTTP response status code MUST be <code>303</code>.</li>
				<li>The HTTP response MUST contain an <code>Location</code> header. The value of this header
				MUST be the <var>output <a>service endpoint</a> URL</a>.</li>
			</ol>
			</li>
		</ol>

		<div class="issue">
			<p>TODO: Review HTTP(S) binding for <a>DID resolution</a> and <a>DID URL dereferencing</a>,
			including the following topics:</p>
			<ul>
				<li>How are <var>input metadata properties</var> passed via HTTP(S)? Using the query string and/or HTTP headers?</li>
				<li>How is the output data (<a>DID document</a>, <a>DID resolution result</a>) returned via HTTP(S)</li>
				<li>What is the <a href="https://github.com/w3c/did-core/issues/1">MIME type of a DID document</a>?
				How should <code>Accept</code> and <code>Content-Type</code> HTTP headers be used?</li>
				<li>Are two separate HTTP(S) endpoints required/allowed for the <code>resolve()</code> and
				<code>dereference()</code> functions, or can/must a single HTTP(S) endpoint be used?</li>
			</ul>
		</div>

	</section>

	<section>
		<h2>Example</h2>
		<p>Given the following <var><a>DID resolver</a> HTTP(S) endpoint</var>:<p>
		<p><code>
https://uniresolver.io/1.0/identifiers/</code></p>
		<p>And given the following <var>input <a>DID</a></var>:</p>
		<p><code>
did:sov:WRfXPg8dantKVubE3HX8pw</code></p>
		<p>Then the <var>request HTTP(S) URL</var> is:</p>
		<p><code>
https://uniresolver.io/1.0/identifiers/did:sov:WRfXPg8dantKVubE3HX8pw</code></p>
		<p>The HTTP(S) binding can be invoked as follows:</p>
		<pre class="example nohighlight" title="Example curl call to a DID resolver via HTTP(S) binding">
curl -X GET https://uniresolver.io/1.0/identifiers/did:sov:WRfXPg8dantKVubE3HX8pw</pre>

	</section>

</section>

<section id="service-endpoint-construction">
	<h1>Service Endpoint Construction</h1>

	<p>This section defines the inputs and the algorithm of <a>Service Endpoint Construction</a>,
	which returns a <a>service endpoint</a> URL as output. This algorithm is used when service endpoints
	are selected during <a>DID URL dereferencing</a> (see <a href="#dereferencing"></a>).</p>

	<p>In this section, <code>path</code>, <code>query</code>, and <code>fragment</code> are understood as defined in [[RFC3986]].</p>

	<section>
		<h2>Input</h2>

		<p>The inputs of the <a>Service Endpoint Construction</a> algorithm are an <var>input <a>DID URL</a></var> and an
		<var>input <a>service endpoint</a> URL</var>.</p>

		<p>The requirements for the inputs of the <a>Service Endpoint Construction</a> algorithm are as follows:</p>
		<ul>
			<li>The <var>input <a>DID URL</a></var> and <var>input <a>service endpoint</a> URL</var> MAY both have a <code>path</code> component.</li>
			<li>The <var>input <a>DID URL</a></var> and <var>input <a>service endpoint</a> URL</var> MUST NOT both have a <code>query</code> component.</li>
			<li>The <var>input <a>DID URL</a></var> and <var>input <a>service endpoint</a> URL</var> MUST NOT both have a <code>fragment</code> component.</li>
			<li>The <var>input <a>service endpoint</a> URL</var> MUST be an HTTP(S) URL.</li>
		</ul>

	</section>

	<section>
		<h2>Algorithm</h2>
		<ol class="algorithm">
			<li>Initialize a string <var>output <a>service endpoint</a> URL</var> to the value of the <var>input <a>service endpoint</a> URL</var></li>
			<li>If the <var>output <a>service endpoint</a> URL</var> has a <code>query</code> component, remove it.</li>
			<li>If the <var>output <a>service endpoint</a> URL</var> has a <code>fragment</code> component, remove it.</li>
			<li>Append the <code>path</code> component of the <var>input <a>DID URL</a></var> to the <var>output <a>service endpoint</a> URL</var>.</li>
			<li>If the <var>input <a>service endpoint</a> URL</var> has a <code>query</code> component, append <code>?</code> plus the <code>query</code> to the <var>output <a>service endpoint</a> URL</var>.</li>
			<li>If the <var>input <a>DID URL</a></var> has a <code>query</code> component, append <code>?</code> plus the <code>query</code> to the <var>output <a>service endpoint</a> URL</var>.</li>
			<li>If the <var>input <a>service endpoint</a> URL</var> has a <code>fragment</code> component, append <code>#</code> plus the <code>fragment</code> to the <var>output <a>service endpoint</a> URL</var>.</li>
			<li>If the <var>input <a>DID URL</a></var> has a <code>fragment</code> component, append <code>#</code> plus the <code>fragment</code> to the <var>output <a>service endpoint</a> URL</var>.</li>
			<li>Return the <var>output <a>service endpoint</a> URL</var>.</li>
		</ol>

		<p class="issue">We could potentially allow a <code>query</code> components on both the
		<var>input <a>DID URL</a></var> and <var>input <a>service endpoint</a> URL</var>, if they both contain lists of
		key/value parameters that can be merged.</p>

		<p class="issue">Details of the Service Endpoint Construction algorithm have been discussed in April 2019
		on the CCG mailing list, e.g. <a href="https://lists.w3.org/Archives/Public/public-credentials/2019Apr/0021.html">here</a>
		or <a href="https://lists.w3.org/Archives/Public/public-credentials/2019Apr/0032.html">here</a>.</p>

		<p class="issue">Instead of defining our own algorithm, we could potentially re-use the "Relative Resolution"
		algorithm defined in [[RFC3986]].</p>

	</section>

	<section>
		<h2>Example</h2>
		<p>Given the following <var>input <a>service endpoint</a> URL</var>:<p>
		<p><code>
https://example.com/messages/8377464</code></p>
		<p>And given the following <var>input <a>DID URL</a></var>:</p>
		<p><code>
did:example:123456789abcdefghi?service=messages&relative-ref=%2Fsome%2Fpath%3Fquery#frag
</code></p>
		<p>Then the <var>output <a>service endpoint</a> URL</var> is:</p>
		<p><code>
https://example.com/messages/8377464/some/path?query#frag
</code></p>

	</section>

</section>

<section id="errors">
	<h1>Errors</h1>
	<p class="issue">Do we need to define a list of error conditions, codes, etc.</p>

</section>

<section id="security-privacy-considerations">
	<h1>Security and Privacy Considerations</h1>

	<section id="authentication">
		<h2>Authentication/Authorization</h2>
		<p><a>DID resolution</a> and <a>DID URL dereferencing</a> do not involve any authentication or authorization
		functionality. Similar to DNS resolution, anybody can perform the process, without requiring any credentials
		or non-public knowledge.</p>

		<p class="issue" data-number="38"></p>

		<div class="issue">
		<p>Explain that DIDs are not necessarily <em>globally</em> resolvable, such as pairwise or N-wise
		"peer" DIDs.</p>
		<p>See [[RFC3339]]:
		<em> URIs have a global scope and are interpreted consistently regardless of context, though the
		result of that interpretation may be in relation to the end-user's context.</em>
		</p>
		<p>An advanced idea is that the result of DID resolution could be contextual or depend on policies,
		see <a href="https://github.com/w3c-ccg/did-resolution/issues/28#issuecomment-510592199">this comment</a>.</p>
		</div>

		<p class="issue">A related topic is whether (parts of) DID document could be encrypted, e.g. see
		<a href="https://github.com/w3c/did-core/issues/25">w3c/did-core/issues/25</a>. Also see the use
		of the fragment in the <a href="https://did-ipid.github.io/ipid-did-method/">IPID</a> DID method.</p>

	</section>

	<section id="caching">
		<h2>Caching</h2>
		<p>A <a>DID resolver</a> may maintain a generic cache of <a>DID documents</a>. It may also maintain caches specific
		to certain <a>DID methods</a>.</p>
		<p>Caching behavior can be controlled by configuration of the <a>DID resolver</a>,
		by the <a href="#resolving-input-no-cache">`no-cache`</a> input metadata property, or by contents of the DID document
		(e.g. a `time-to-live` field), or by a combination of these properties.</p>
		<p class="issue" data-number="10">See corresponding open issue.</p>
		<p class="issue">Perhaps we can re-use caching mechanisms of other protocols such as HTTP.</p>
	
	</section>

	<section id="versioning">
		<h2>Versioning</h2>
		<p>If a <a href="#resolving-input-version-id">`version-id`</a> or
		<a href="#resolving-input-version-time">`version-time`</a> input metadata property is provided, the <a>DID resolution</a>
		algorithm returns a certain version of the <a>DID document</a>.</p>
		<p>A DID document MAY contain a version identifier that changes with each 
		<a href="https://w3c.github.io/did-core/#update">Update</a> operation that is performed
		on a DID.</p>
		<p class="issue" data-number="12">See corresponding open issue.</p>
		<p class="note">While most <a>DID methods</a> support the <a href="https://w3c.github.io/did-core/#update">Update</a>
		operation, there is no requirement for <a>DID methods</a> to keep all previous <a>DID document</a> versions, therefore
		not all <a>DID methods</a> support versioning.
		</p>
	
	</section>
	
	<section id="non-did-identifiers">
		<h2>Non-DID Identifiers</h2>
		<p class="issue" data-number="8">There is discussion on the relationship between <a>DID resolution</a> and
		resolution of non-DID identifiers such as domain names, HTTP URIs, or e-mail addresses. This includes the
		questions how DIDs can be discovered from non-DID identifiers, and how links between identifiers can
		be verifiable.</p>
	
	</section>

	<section id="did-method-governance">
		<h2>DID Method Governance</h2>
		<p class="issue" data-number="6">Describe which methods a <a>DID resolver</a> should support, and potential implications.</p>

	</section>

</section>

<section id="future-work">
	<h1>Future Work</h1>
	<p class="note">This section lists additional <a>DID URL dereferencing</a> features that are under discussion and
	have not yet been incorporated into the algorithm.</p>

	<section id="redirect">
		<h3>Redirect</h3>
		<p>A <a href="https://w3c.github.io/did-core/#service-endpoints">service endpoint</a> may have
		a <code>serviceEndpoint</code> property with a value that is itself
		a DID. This is interpreted as a "DID redirect" from the input DID to another. In this case, a "child"
		DID resolution process can be launched to get to a "final" service endpoint.</p>

		<p class="issue" data-number="7">See corresponding open issue.
		</p>

		<p class="issue" data-number="36">DID redirects could not only apply to a single service endpoint, but
		to an entire DID document, therefore enabling portability use cases.
		</p>

		<pre class="example nohighlight">
{
   "id": "did:example:123456789abcdefghi#hub1",
   "type": "HubService",
   "serviceEndpoint": "did:example:xyz"
}
</pre>

	</section>

	<section id="proxy">
		<h3>Proxy</h3>
		<p>A DID document may contain a "proxy" service type which would provide a mapping that 
		needs to be followed in order to resolve to a final service URL.</p>

		<p class="issue" data-number="35"></p>
		</p>

		<pre class="example nohighlight">
{
   "id": "did:example:123456789abcdefghi",
   "type": "ProxyService",
   "serviceEndpoint": "https://mydomain.com/proxy"
}
</pre>

	</section>

	<section id="json-pointer">
		<h3>JSON Pointer</h3>
		<div class="issue">
		<p>Several ways of selecting parts of a DID document are being discussed, including the use
		of JSON pointer.</p>
		<p>See corresponding PRs <a href="https://github.com/w3c-ccg/did-spec/pull/161">here</a>
		and <a href="https://github.com/w3c/did-core/pull/257">here</a>.</p>
		</div>

	</section>

</section>

<section class="appendix">
	<h1>DID Resolution Resources</h1>

	<ol>
	<li><a href="https://w3c.github.io/did-core/#resolution">DID resolvers in DID Core specification</a></li>
	<li><a href="https://github.com/decentralized-identity/universal-resolver/">Universal Resolver</a></li>
	<li><a href="https://github.com/digitalbazaar/did-client">did-client</a></li>
	<li><a href="https://github.com/uport-project/did-resolver">uPort DID resolver</a></li>
	</ol>

</section>

</body>
</html>
